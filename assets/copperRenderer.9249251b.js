var ie=Object.defineProperty;var re=(c,e,t)=>e in c?ie(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var w=(c,e,t)=>(re(c,typeof e!="symbol"?e+"":e,t),t);import{C as oe,V as z,b as ae,L as ce,M as B,R as le,D as he,B as U,P as O,I as ue,c as de,d as Y,e as fe,N as pe,g as me,h as ge,i as xe,j as Te,k as ye,m as we,n as Me,o as Ee,p as te,W as K,q as Re,r as H,t as Ie,u as be,G as Ae,v as Se,w as Ce,x as Ne,y as ve,A as W,z as Le,E as q,F as _e,H as Fe,K as Pe,J as Ue,O as ze}from"./index.eb258893.js";var P=function(){var c=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(d){d.preventDefault(),s(++c%e.children.length)},!1);function t(d){return e.appendChild(d.dom),d}function s(d){for(var u=0;u<e.children.length;u++)e.children[u].style.display=u===d?"block":"none";c=d}var n=(performance||Date).now(),i=n,r=0,o=t(new P.Panel("FPS","#0ff","#002")),a=t(new P.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=t(new P.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:e,addPanel:t,showPanel:s,begin:function(){n=(performance||Date).now()},end:function(){r++;var d=(performance||Date).now();if(a.update(d-n,200),d>=i+1e3&&(o.update(r*1e3/(d-i),100),i=d,r=0,l)){var u=performance.memory;l.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return d},update:function(){n=this.end()},domElement:e,setMode:s}};P.Panel=function(c,e,t){var s=1/0,n=0,i=Math.round,r=i(window.devicePixelRatio||1),o=80*r,a=48*r,l=3*r,d=2*r,u=3*r,m=15*r,h=74*r,f=30*r,p=document.createElement("canvas");p.width=o,p.height=a,p.style.cssText="width:80px;height:48px";var g=p.getContext("2d");return g.font="bold "+9*r+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=t,g.fillRect(0,0,o,a),g.fillStyle=e,g.fillText(c,l,d),g.fillRect(u,m,h,f),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(u,m,h,f),{dom:p,update:function(x,R){s=Math.min(s,x),n=Math.max(n,x),g.fillStyle=t,g.globalAlpha=1,g.fillRect(0,0,o,m),g.fillStyle=e,g.fillText(i(x)+" "+c+" ("+i(s)+"-"+i(n)+")",l,d),g.drawImage(p,u+r,m,h-r,f,u,m,h-r,f),g.fillRect(u+h-r,m,r,f),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(u+h-r,m,r,i((1-x/R)*f))}}};const Oe=P,X={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class V{constructor(){this.pluginCallbacks=[],this.register(function(e){return new We(e)}),this.register(function(e){return new qe(e)}),this.register(function(e){return new Ze(e)}),this.register(function(e){return new $e(e)}),this.register(function(e){return new Qe(e)}),this.register(function(e){return new et(e)}),this.register(function(e){return new Xe(e)}),this.register(function(e){return new Je(e)}),this.register(function(e){return new tt(e)}),this.register(function(e){return new st(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){const i=new Ke,r=[];for(let o=0,a=this.pluginCallbacks.length;o<a;o++)r.push(this.pluginCallbacks[o](i));i.setPlugins(r),i.write(e,t,n).catch(s)}parseAsync(e,t){const s=this;return new Promise(function(n,i){s.parse(e,n,i,t)})}}const T={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},G="KHR_mesh_quantization",S={};S[pe]=T.NEAREST;S[me]=T.NEAREST_MIPMAP_NEAREST;S[ge]=T.NEAREST_MIPMAP_LINEAR;S[xe]=T.LINEAR;S[Te]=T.LINEAR_MIPMAP_NEAREST;S[ye]=T.LINEAR_MIPMAP_LINEAR;S[we]=T.CLAMP_TO_EDGE;S[Me]=T.REPEAT;S[Ee]=T.MIRRORED_REPEAT;const J={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},ke=new oe,Z=12,Ge=1179937895,De=2,$=8,Be=1313821514,He=5130562;function F(c,e){return c.length===e.length&&c.every(function(t,s){return t===e[s]})}function Ve(c){return new TextEncoder().encode(c).buffer}function je(c){return F(c.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Ye(c,e,t){const s={min:new Array(c.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(c.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=e;n<e+t;n++)for(let i=0;i<c.itemSize;i++){let r;c.itemSize>4?r=c.array[n*c.itemSize+i]:(i===0?r=c.getX(n):i===1?r=c.getY(n):i===2?r=c.getZ(n):i===3&&(r=c.getW(n)),c.normalized===!0&&(r=B.normalize(r,c.array))),s.min[i]=Math.min(s.min[i],r),s.max[i]=Math.max(s.max[i],r)}return s}function se(c){return Math.ceil(c/4)*4}function D(c,e=0){const t=se(c.byteLength);if(t!==c.byteLength){const s=new Uint8Array(t);if(s.set(new Uint8Array(c)),e!==0)for(let n=c.byteLength;n<t;n++)s[n]=e;return s.buffer}return c}function Q(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function ee(c,e){if(c.toBlob!==void 0)return new Promise(s=>c.toBlob(s,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),c.convertToBlob({type:e,quality:t})}class Ke{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const n=this,i=n.buffers,r=n.json;s=n.options;const o=n.extensionsUsed,a=n.extensionsRequired,l=new Blob(i,{type:"application/octet-stream"}),d=Object.keys(o),u=Object.keys(a);if(d.length>0&&(r.extensionsUsed=d),u.length>0&&(r.extensionsRequired=u),r.buffers&&r.buffers.length>0&&(r.buffers[0].byteLength=l.size),s.binary===!0){const m=new FileReader;m.readAsArrayBuffer(l),m.onloadend=function(){const h=D(m.result),f=new DataView(new ArrayBuffer($));f.setUint32(0,h.byteLength,!0),f.setUint32(4,He,!0);const p=D(Ve(JSON.stringify(r)),32),g=new DataView(new ArrayBuffer($));g.setUint32(0,p.byteLength,!0),g.setUint32(4,Be,!0);const x=new ArrayBuffer(Z),R=new DataView(x);R.setUint32(0,Ge,!0),R.setUint32(4,De,!0);const y=Z+g.byteLength+p.byteLength+f.byteLength+h.byteLength;R.setUint32(8,y,!0);const M=new Blob([x,g,p,f,h],{type:"application/octet-stream"}),E=new FileReader;E.readAsArrayBuffer(M),E.onloadend=function(){t(E.result)}}}else if(r.buffers&&r.buffers.length>0){const m=new FileReader;m.readAsDataURL(l),m.onloadend=function(){const h=m.result;r.buffers[0].uri=h,t(r)}}else t(r)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const s=this.options,n=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&i.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const r in i.gltfExtensions)t.extensions[r]=i.gltfExtensions[r],n[r]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(i){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+i.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const s=new z;for(let n=0,i=e.count;n<i;n++)if(Math.abs(s.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const s=e.clone(),n=new z;for(let i=0,r=s.count;i<r;i++)n.fromBufferAttribute(s,i),n.x===0&&n.y===0&&n.z===0?n.setX(1):n.normalize(),s.setXYZ(i,n.x,n.y,n.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1;const n={};(t.offset.x!==0||t.offset.y!==0)&&(n.offset=t.offset.toArray(),s=!0),t.rotation!==0&&(n.rotation=t.rotation,s=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(n.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function s(h){return h.encoding===te?function(p){return p<.04045?p*.0773993808:Math.pow(p*.9478672986+.0521327014,2.4)}:function(p){return p}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const n=e?e.image:null,i=t?t.image:null,r=Math.max(n?n.width:0,i?i.width:0),o=Math.max(n?n.height:0,i?i.height:0),a=Q();a.width=r,a.height=o;const l=a.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,r,o);const d=l.getImageData(0,0,r,o);if(n){l.drawImage(n,0,0,r,o);const h=s(e),f=l.getImageData(0,0,r,o).data;for(let p=2;p<f.length;p+=4)d.data[p]=h(f[p]/256)*256}if(i){l.drawImage(i,0,0,r,o);const h=s(t),f=l.getImageData(0,0,r,o).data;for(let p=1;p<f.length;p+=4)d.data[p]=h(f[p]/256)*256}l.putImageData(d,0,0);const m=(e||t).clone();return m.source=new ae(a),m.encoding=ce,m}processBuffer(e){const t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,t,s,n,i){const r=this.json;r.bufferViews||(r.bufferViews=[]);let o;switch(t){case T.BYTE:case T.UNSIGNED_BYTE:o=1;break;case T.SHORT:case T.UNSIGNED_SHORT:o=2;break;default:o=4}const a=se(n*e.itemSize*o),l=new DataView(new ArrayBuffer(a));let d=0;for(let h=s;h<s+n;h++)for(let f=0;f<e.itemSize;f++){let p;e.itemSize>4?p=e.array[h*e.itemSize+f]:(f===0?p=e.getX(h):f===1?p=e.getY(h):f===2?p=e.getZ(h):f===3&&(p=e.getW(h)),e.normalized===!0&&(p=B.normalize(p,e.array))),t===T.FLOAT?l.setFloat32(d,p,!0):t===T.INT?l.setInt32(d,p,!0):t===T.UNSIGNED_INT?l.setUint32(d,p,!0):t===T.SHORT?l.setInt16(d,p,!0):t===T.UNSIGNED_SHORT?l.setUint16(d,p,!0):t===T.BYTE?l.setInt8(d,p):t===T.UNSIGNED_BYTE&&l.setUint8(d,p),d+=o}const u={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:a};return i!==void 0&&(u.target=i),i===T.ARRAY_BUFFER&&(u.byteStride=e.itemSize*o),this.byteOffset+=a,r.bufferViews.push(u),{id:r.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(n){const i=new FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){const r=D(i.result),o={buffer:t.processBuffer(r),byteOffset:t.byteOffset,byteLength:r.byteLength};t.byteOffset+=r.byteLength,n(s.bufferViews.push(o)-1)}})}processAccessor(e,t,s,n){const i=this.json,r={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let o;if(e.array.constructor===Float32Array)o=T.FLOAT;else if(e.array.constructor===Int32Array)o=T.INT;else if(e.array.constructor===Uint32Array)o=T.UNSIGNED_INT;else if(e.array.constructor===Int16Array)o=T.SHORT;else if(e.array.constructor===Uint16Array)o=T.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)o=T.BYTE;else if(e.array.constructor===Uint8Array)o=T.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(s===void 0&&(s=0),n===void 0&&(n=e.count),n===0)return null;const a=Ye(e,s,n);let l;t!==void 0&&(l=e===t.index?T.ELEMENT_ARRAY_BUFFER:T.ARRAY_BUFFER);const d=this.processBufferView(e,o,s,n,l),u={bufferView:d.id,byteOffset:d.byteOffset,componentType:o,count:n,max:a.max,min:a.min,type:r[e.itemSize]};return e.normalized===!0&&(u.normalized=!0),i.accessors||(i.accessors=[]),i.accessors.push(u)-1}processImage(e,t,s,n="image/png"){if(e!==null){const i=this,r=i.cache,o=i.json,a=i.options,l=i.pending;r.images.has(e)||r.images.set(e,{});const d=r.images.get(e),u=n+":flipY/"+s.toString();if(d[u]!==void 0)return d[u];o.images||(o.images=[]);const m={mimeType:n},h=Q();h.width=Math.min(e.width,a.maxTextureSize),h.height=Math.min(e.height,a.maxTextureSize);const f=h.getContext("2d");if(s===!0&&(f.translate(0,h.height),f.scale(1,-1)),e.data!==void 0){t!==le&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>a.maxTextureSize||e.height>a.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const g=new Uint8ClampedArray(e.height*e.width*4);for(let x=0;x<g.length;x+=4)g[x+0]=e.data[x+0],g[x+1]=e.data[x+1],g[x+2]=e.data[x+2],g[x+3]=e.data[x+3];f.putImageData(new ImageData(g,e.width,e.height),0,0)}else f.drawImage(e,0,0,h.width,h.height);a.binary===!0?l.push(ee(h,n).then(g=>i.processBufferViewImage(g)).then(g=>{m.bufferView=g})):h.toDataURL!==void 0?m.uri=h.toDataURL(n):l.push(ee(h,n).then(g=>new FileReader().readAsDataURL(g)).then(g=>{m.uri=g}));const p=o.images.push(m)-1;return d[u]=p,p}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const s={magFilter:S[e.magFilter],minFilter:S[e.minFilter],wrapS:S[e.wrapS],wrapT:S[e.wrapT]};return t.samplers.push(s)-1}processTexture(e){const t=this.cache,s=this.json;if(t.textures.has(e))return t.textures.get(e);s.textures||(s.textures=[]);let n=e.userData.mimeType;n==="image/webp"&&(n="image/png");const i={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,n)};e.name&&(i.name=e.name),this._invokeAll(function(o){o.writeTexture&&o.writeTexture(e,i)});const r=s.textures.push(i)-1;return t.textures.set(e,r),r}processMaterial(e){const t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const n={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const i=e.color.toArray().concat([e.opacity]);if(F(i,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=i),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=.5,n.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const o=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),a={index:this.processTexture(o)};this.applyTextureTransform(a,o),n.pbrMetallicRoughness.metallicRoughnessTexture=a}if(e.map){const o={index:this.processTexture(e.map)};this.applyTextureTransform(o,e.map),n.pbrMetallicRoughness.baseColorTexture=o}if(e.emissive){const o=e.emissive;if(Math.max(o.r,o.g,o.b)>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const l={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(l,e.emissiveMap),n.emissiveTexture=l}}if(e.normalMap){const o={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(o.scale=e.normalScale.x),this.applyTextureTransform(o,e.normalMap),n.normalTexture=o}if(e.aoMap){const o={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(o.strength=e.aoMapIntensity),this.applyTextureTransform(o,e.aoMap),n.occlusionTexture=o}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===he&&(n.doubleSided=!0),e.name!==""&&(n.name=e.name),this.serializeUserData(e,n),this._invokeAll(function(o){o.writeMaterial&&o.writeMaterial(e,n)});const r=s.materials.push(n)-1;return t.materials.set(e,r),r}processMesh(e){const t=this.cache,s=this.json,n=[e.geometry.uuid];if(Array.isArray(e.material))for(let y=0,M=e.material.length;y<M;y++)n.push(e.material[y].uuid);else n.push(e.material.uuid);const i=n.join(":");if(t.meshes.has(i))return t.meshes.get(i);const r=e.geometry;let o;e.isLineSegments?o=T.LINES:e.isLineLoop?o=T.LINE_LOOP:e.isLine?o=T.LINE_STRIP:e.isPoints?o=T.POINTS:o=e.material.wireframe?T.LINES:T.TRIANGLES;const a={},l={},d=[],u=[],m={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},h=r.getAttribute("normal");h!==void 0&&!this.isNormalizedNormalAttribute(h)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),r.setAttribute("normal",this.createNormalizedNormalAttribute(h)));let f=null;for(let y in r.attributes){if(y.slice(0,5)==="morph")continue;const M=r.attributes[y];if(y=m[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(M))){l[y]=t.attributes.get(this.getUID(M));continue}f=null;const I=M.array;y==="JOINTS_0"&&!(I instanceof Uint16Array)&&!(I instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new U(new Uint16Array(I),M.itemSize,M.normalized));const A=this.processAccessor(f||M,r);A!==null&&(y.startsWith("_")||this.detectMeshQuantization(y,M),l[y]=A,t.attributes.set(this.getUID(M),A))}if(h!==void 0&&r.setAttribute("normal",h),Object.keys(l).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const y=[],M=[],E={};if(e.morphTargetDictionary!==void 0)for(const I in e.morphTargetDictionary)E[e.morphTargetDictionary[I]]=I;for(let I=0;I<e.morphTargetInfluences.length;++I){const A={};let j=!1;for(const v in r.morphAttributes){if(v!=="position"&&v!=="normal"){j||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),j=!0);continue}const C=r.morphAttributes[v][I],k=v.toUpperCase(),L=r.attributes[v];if(t.attributes.has(this.getUID(C,!0))){A[k]=t.attributes.get(this.getUID(C,!0));continue}const _=C.clone();if(!r.morphTargetsRelative)for(let b=0,ne=C.count;b<ne;b++)for(let N=0;N<C.itemSize;N++)N===0&&_.setX(b,C.getX(b)-L.getX(b)),N===1&&_.setY(b,C.getY(b)-L.getY(b)),N===2&&_.setZ(b,C.getZ(b)-L.getZ(b)),N===3&&_.setW(b,C.getW(b)-L.getW(b));A[k]=this.processAccessor(_,r),t.attributes.set(this.getUID(L,!0),A[k])}u.push(A),y.push(e.morphTargetInfluences[I]),e.morphTargetDictionary!==void 0&&M.push(E[I])}a.weights=y,M.length>0&&(a.extras={},a.extras.targetNames=M)}const p=Array.isArray(e.material);if(p&&r.groups.length===0)return null;const g=p?e.material:[e.material],x=p?r.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,M=x.length;y<M;y++){const E={mode:o,attributes:l};if(this.serializeUserData(r,E),u.length>0&&(E.targets=u),r.index!==null){let A=this.getUID(r.index);(x[y].start!==void 0||x[y].count!==void 0)&&(A+=":"+x[y].start+":"+x[y].count),t.attributes.has(A)?E.indices=t.attributes.get(A):(E.indices=this.processAccessor(r.index,r,x[y].start,x[y].count),t.attributes.set(A,E.indices)),E.indices===null&&delete E.indices}const I=this.processMaterial(g[x[y].materialIndex]);I!==null&&(E.material=I),d.push(E)}a.primitives=d,s.meshes||(s.meshes=[]),this._invokeAll(function(y){y.writeMesh&&y.writeMesh(e,a)});const R=s.meshes.push(a)-1;return t.meshes.set(i,R),R}detectMeshQuantization(e,t){if(this.extensionsUsed[G])return;let s;switch(t.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}t.normalized&&(s+=" normalized");const n=e.split("_",1)[0];X[n]&&X[n].includes(s)&&(this.extensionsUsed[G]=!0,this.extensionsRequired[G]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const s=e.isOrthographicCamera,n={type:s?"orthographic":"perspective"};return s?n.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:B.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){const s=this.json,n=this.nodeMap;s.animations||(s.animations=[]),e=V.Utils.mergeMorphTargetTracks(e.clone(),t);const i=e.tracks,r=[],o=[];for(let a=0;a<i.length;++a){const l=i[a],d=O.parseTrackName(l.name);let u=O.findNode(t,d.nodeName);const m=J[d.propertyName];if(d.objectName==="bones"&&(u.isSkinnedMesh===!0?u=u.skeleton.getBoneByName(d.objectIndex):u=void 0),!u||!m)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;const h=1;let f=l.values.length/l.times.length;m===J.morphTargetInfluences&&(f/=u.morphTargetInfluences.length);let p;l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(p="CUBICSPLINE",f/=3):l.getInterpolation()===ue?p="STEP":p="LINEAR",o.push({input:this.processAccessor(new U(l.times,h)),output:this.processAccessor(new U(l.values,f)),interpolation:p}),r.push({sampler:o.length-1,target:{node:n.get(u),path:m}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:o,channels:r}),s.animations.length-1}processSkin(e){const t=this.json,s=this.nodeMap,n=t.nodes[s.get(e)],i=e.skeleton;if(i===void 0)return null;const r=e.skeleton.bones[0];if(r===void 0)return null;const o=[],a=new Float32Array(i.bones.length*16),l=new de;for(let u=0;u<i.bones.length;++u)o.push(s.get(i.bones[u])),l.copy(i.boneInverses[u]),l.multiply(e.bindMatrix).toArray(a,u*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new U(a,16)),joints:o,skeleton:s.get(r)}),n.skin=t.skins.length-1}processNode(e){const t=this.json,s=this.options,n=this.nodeMap;t.nodes||(t.nodes=[]);const i={};if(s.trs){const o=e.quaternion.toArray(),a=e.position.toArray(),l=e.scale.toArray();F(o,[0,0,0,1])||(i.rotation=o),F(a,[0,0,0])||(i.translation=a),F(l,[1,1,1])||(i.scale=l)}else e.matrixAutoUpdate&&e.updateMatrix(),je(e.matrix)===!1&&(i.matrix=e.matrix.elements);if(e.name!==""&&(i.name=String(e.name)),this.serializeUserData(e,i),e.isMesh||e.isLine||e.isPoints){const o=this.processMesh(e);o!==null&&(i.mesh=o)}else e.isCamera&&(i.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const o=[];for(let a=0,l=e.children.length;a<l;a++){const d=e.children[a];if(d.visible||s.onlyVisible===!1){const u=this.processNode(d);u!==null&&o.push(u)}}o.length>0&&(i.children=o)}this._invokeAll(function(o){o.writeNode&&o.writeNode(e,i)});const r=t.nodes.push(i)-1;return n.set(e,r),r}processScene(e){const t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);const n={};e.name!==""&&(n.name=e.name),t.scenes.push(n);const i=[];for(let r=0,o=e.children.length;r<o;r++){const a=e.children[r];if(a.visible||s.onlyVisible===!1){const l=this.processNode(a);l!==null&&i.push(l)}}i.length>0&&(n.nodes=i),this.serializeUserData(e,n)}processObjects(e){const t=new Y;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(n){n.beforeParse&&n.beforeParse(e)});const s=[];for(let n=0;n<e.length;n++)e[n]instanceof Y?this.processScene(e[n]):s.push(e[n]);s.length>0&&this.processObjects(s);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll(function(n){n.afterParse&&n.afterParse(e)})}_invokeAll(e){for(let t=0,s=this.plugins.length;t<s;t++)e(this.plugins[t])}}class We{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const s=this.writer,n=s.json,i=s.extensionsUsed,r={};e.name&&(r.name=e.name),r.color=e.color.toArray(),r.intensity=e.intensity,e.isDirectionalLight?r.type="directional":e.isPointLight?(r.type="point",e.distance>0&&(r.range=e.distance)):e.isSpotLight&&(r.type="spot",e.distance>0&&(r.range=e.distance),r.spot={},r.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,r.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},i[this.name]=!0);const o=n.extensions[this.name].lights;o.push(r),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}}class qe{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Xe{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const s=this.writer,n=s.extensionsUsed,i={};if(i.clearcoatFactor=e.clearcoat,e.clearcoatMap){const r={index:s.processTexture(e.clearcoatMap)};s.applyTextureTransform(r,e.clearcoatMap),i.clearcoatTexture=r}if(i.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const r={index:s.processTexture(e.clearcoatRoughnessMap)};s.applyTextureTransform(r,e.clearcoatRoughnessMap),i.clearcoatRoughnessTexture=r}if(e.clearcoatNormalMap){const r={index:s.processTexture(e.clearcoatNormalMap)};s.applyTextureTransform(r,e.clearcoatNormalMap),i.clearcoatNormalTexture=r}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Je{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const s=this.writer,n=s.extensionsUsed,i={};if(i.iridescenceFactor=e.iridescence,e.iridescenceMap){const r={index:s.processTexture(e.iridescenceMap)};s.applyTextureTransform(r,e.iridescenceMap),i.iridescenceTexture=r}if(i.iridescenceIor=e.iridescenceIOR,i.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],i.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const r={index:s.processTexture(e.iridescenceThicknessMap)};s.applyTextureTransform(r,e.iridescenceThicknessMap),i.iridescenceThicknessTexture=r}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Ze{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,n=s.extensionsUsed,i={};if(i.transmissionFactor=e.transmission,e.transmissionMap){const r={index:s.processTexture(e.transmissionMap)};s.applyTextureTransform(r,e.transmissionMap),i.transmissionTexture=r}t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class $e{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,n=s.extensionsUsed,i={};if(i.thicknessFactor=e.thickness,e.thicknessMap){const r={index:s.processTexture(e.thicknessMap)};s.applyTextureTransform(r,e.thicknessMap),i.thicknessTexture=r}i.attenuationDistance=e.attenuationDistance,i.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class Qe{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class et{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(ke)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const s=this.writer,n=s.extensionsUsed,i={};if(e.specularIntensityMap){const r={index:s.processTexture(e.specularIntensityMap)};s.applyTextureTransform(r,e.specularIntensityMap),i.specularTexture=r}if(e.specularColorMap){const r={index:s.processTexture(e.specularColorMap)};s.applyTextureTransform(r,e.specularColorMap),i.specularColorTexture=r}i.specularFactor=e.specularIntensity,i.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class tt{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const s=this.writer,n=s.extensionsUsed,i={};if(e.sheenRoughnessMap){const r={index:s.processTexture(e.sheenRoughnessMap)};s.applyTextureTransform(r,e.sheenRoughnessMap),i.sheenRoughnessTexture=r}if(e.sheenColorMap){const r={index:s.processTexture(e.sheenColorMap)};s.applyTextureTransform(r,e.sheenColorMap),i.sheenColorTexture=r}i.sheenRoughnessFactor=e.sheenRoughness,i.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class st{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}V.Utils={insertKeyframe:function(c,e){const s=c.getValueSize(),n=new c.TimeBufferType(c.times.length+1),i=new c.ValueBufferType(c.values.length+s),r=c.createInterpolant(new c.ValueBufferType(s));let o;if(c.times.length===0){n[0]=e;for(let a=0;a<s;a++)i[a]=0;o=0}else if(e<c.times[0]){if(Math.abs(c.times[0]-e)<.001)return 0;n[0]=e,n.set(c.times,1),i.set(r.evaluate(e),0),i.set(c.values,s),o=0}else if(e>c.times[c.times.length-1]){if(Math.abs(c.times[c.times.length-1]-e)<.001)return c.times.length-1;n[n.length-1]=e,n.set(c.times,0),i.set(c.values,0),i.set(r.evaluate(e),c.values.length),o=n.length-1}else for(let a=0;a<c.times.length;a++){if(Math.abs(c.times[a]-e)<.001)return a;if(c.times[a]<e&&c.times[a+1]>e){n.set(c.times.slice(0,a+1),0),n[a+1]=e,n.set(c.times.slice(a+1),a+2),i.set(c.values.slice(0,(a+1)*s),0),i.set(r.evaluate(e),(a+1)*s),i.set(c.values.slice((a+1)*s),(a+2)*s),o=a+1;break}}return c.times=n,c.values=i,o},mergeMorphTargetTracks:function(c,e){const t=[],s={},n=c.tracks;for(let i=0;i<n.length;++i){let r=n[i];const o=O.parseTrackName(r.name),a=O.findNode(e,o.nodeName);if(o.propertyName!=="morphTargetInfluences"||o.propertyIndex===void 0){t.push(r);continue}if(r.createInterpolant!==r.InterpolantFactoryMethodDiscrete&&r.createInterpolant!==r.InterpolantFactoryMethodLinear){if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),r=r.clone(),r.setInterpolation(fe)}const l=a.morphTargetInfluences.length,d=a.morphTargetDictionary[o.propertyIndex];if(d===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let u;if(s[a.uuid]===void 0){u=r.clone();const h=new u.ValueBufferType(l*u.times.length);for(let f=0;f<u.times.length;f++)h[f*l+d]=u.values[f];u.name=(o.nodeName||"")+".morphTargetInfluences",u.values=h,s[a.uuid]=u,t.push(u);continue}const m=r.createInterpolant(new r.ValueBufferType(1));u=s[a.uuid];for(let h=0;h<u.times.length;h++)u.values[h*l+d]=m.evaluate(u.times[h]);for(let h=0;h<r.times.length;h++){const f=this.insertKeyframe(u,r.times[h]);u.values[f*l+d]=r.values[h]}}return c.tracks=t,c}};class nt{constructor(e){w(this,"gltfExporter",new V);w(this,"options",{trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!1,maxTextureSize:4096e7,animations:[]});w(this,"link");Object.assign(this.options,e),this.link=document.createElement("a"),this.link.style.display="none",document.body.appendChild(this.link)}export(e){const t=e.name?e.name:"export";this.gltfExporter.parse(e,s=>{if(s instanceof ArrayBuffer)this.saveArrayBuffer(s,t+".glb");else{const n=JSON.stringify(s,null,2);this.saveString(n,t+".gltf")}},function(s){console.log("An error happened during parsing",s)},this.options)}save(e,t){this.link.href=URL.createObjectURL(e),this.link.download=t,this.link.click()}saveString(e,t){this.save(new Blob([e],{type:"text/plain"}),t)}saveArrayBuffer(e,t){this.save(new Blob([e],{type:"application/octet-stream"}),t)}}class it{constructor(e,t){w(this,"container");w(this,"renderer");w(this,"gui");w(this,"stats");w(this,"currentScene");w(this,"pmremGenerator");w(this,"options");w(this,"state");w(this,"visualiseFolder");w(this,"visualCtrls",[]);w(this,"cameraFolder");w(this,"exporter",null);var s,n;this.container=e,this.options=t,(s=this.options)!=null&&s.alpha?(this.renderer=new K({antialias:!0,alpha:!0}),this.setClearColor()):this.renderer=new K({antialias:!0}),this.renderer.physicallyCorrectLights=!0,this.renderer.outputEncoding=te,this.gui=null,this.stats=Oe(),this.pmremGenerator=new Re(this.renderer),this.pmremGenerator.compileEquirectangularShader(),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),(n=this.options)!=null&&n.alpha?this.currentScene=new H(this.container,this.renderer,!0):this.currentScene=new H(this.container,this.renderer,!1),this.currentScene.sceneName="default",this.currentScene.vignette&&this.updateEnvironment(this.currentScene.vignette),this.state={playbackSpeed:1,wireframe:!1,skeleton:!1,grid:!1,addLights:!0,exposure:1,ambientIntensity:.3,ambientColor:2105376,directIntensity:.8*Math.PI,directColor:16777215,bgColor1:"#5454ad",bgColor2:"#18e5a7",exportGltf:()=>{this.exporter||(this.exporter=new nt({animations:this.currentScene.exportContent.animations})),this.exporter.export(this.currentScene.exportContent)}},this.visualiseFolder=null,this.cameraFolder=null,this.init()}init(){var e;this.currentScene.sceneName===""&&(this.currentScene.sceneName="default"),((e=this.options)==null?void 0:e.guiOpen)&&!this.gui&&this.addGui(),[].forEach.call(this.stats.dom.children,t=>t.style.display=""),this.container.appendChild(this.renderer.domElement)}updateEnvironment(e){const t=Ie.filter(s=>s.name==="Venice Sunset")[0];this.getCubeMapTexture(t).then(s=>{const n=this.getCurrentScene();s&&e&&(n==null||n.scene.add(e.mesh)),n.scene.environment=s,n.scene.background=s})}getCubeMapTexture(e){const{path:t}=e;return t?new Promise((s,n)=>{new be().load(t,i=>{const r=this.pmremGenerator.fromEquirectangular(i).texture;this.pmremGenerator.dispose(),s(r)},void 0,n)}):Promise.resolve({envMap:null})}getCurrentScene(){return this.currentScene}hideGui(){this.gui&&this.gui.hide()}closeGui(){this.gui&&(this.gui.closed=!0)}setClearColor(e=0,t=0){this.renderer.setClearColor(e,t)}addGui(){var r,o,a;const e=this.gui=new Ae({width:260}),t=e.addFolder("Visualisation settings");t.add(this.state,"wireframe").onChange(()=>this.currentScene.updateDisplay(this.state)),this.visualiseFolder=t.addFolder("ModelVisualisation");const n=t.addColor(this.state,"bgColor1"),i=t.addColor(this.state,"bgColor2");if(n.onChange(()=>this.currentScene.updateBackground(this.state.bgColor1,this.state.bgColor2)),i.onChange(()=>this.currentScene.updateBackground(this.state.bgColor1,this.state.bgColor2)),(r=this.options)!=null&&r.camera&&(this.cameraFolder=e.addFolder("Camera")),(o=this.options)!=null&&o.performance){const l=e.addFolder("Performance"),d=document.createElement("li");this.stats.dom.style.position="static",d.appendChild(this.stats.dom),d.style.height="50px",l.__ul.appendChild(d)}if((a=this.options)!=null&&a.light){const l=e.addFolder("LightsFolder");[l.add(this.state,"addLights").listen(),l.add(this.state,"ambientIntensity",0,2),l.addColor(this.state,"ambientColor"),l.add(this.state,"directIntensity",0,4),l.addColor(this.state,"directColor")].forEach(d=>d.onChange(()=>this.currentScene.updateLights(this.state)))}e.add(this.state,"exportGltf")}updateGui(){this.visualCtrls.length!==0&&this.visualCtrls.forEach(s=>{var n;(n=this.visualiseFolder)==null||n.remove(s)}),this.visualCtrls=[];let e=0;const t=setInterval(()=>{var i,r,o,a,l,d,u,m;(this.currentScene.content.children.length>0||e>=5)&&(e=0,clearInterval(t));let s=[];(i=this.currentScene.content)==null||i.children;const n=h=>{if(h.isMesh){const f={name:h.name||"Untitled",visible:h.visible,mesh:h};s.push(f)}};if((r=this.currentScene.content)==null||r.traverse(h=>{h.isMesh&&n(h)}),s.forEach(h=>{const f=this.visualiseFolder.add(h,"visible").name(h.name).onChange(()=>{this.currentScene.updateModelChildrenVisualisation(h.mesh)});this.visualCtrls.push(f)}),this.cameraFolder){if(this.cameraFolder.__controllers.length>0){const g=[];this.cameraFolder.__controllers.forEach(x=>{g.push(x)}),g.forEach(x=>{var R;(R=this.cameraFolder)==null||R.remove(x)})}(o=this.cameraFolder)==null||o.add(this.currentScene.camera,"near"),(a=this.cameraFolder)==null||a.add(this.currentScene.camera,"far");const h=(l=this.cameraFolder)==null?void 0:l.__folders;for(let g in h)if(Object.prototype.hasOwnProperty.call(h,g)){const x=h[g];(d=this.cameraFolder)==null||d.removeFolder(x)}const f=(u=this.cameraFolder)==null?void 0:u.addFolder("position");f.add(this.currentScene.camera.position,"x"),f.add(this.currentScene.camera.position,"y"),f.add(this.currentScene.camera.position,"z");const p=(m=this.cameraFolder)==null?void 0:m.addFolder("up");p.add(this.currentScene.camera.up,"x"),p.add(this.currentScene.camera.up,"y"),p.add(this.currentScene.camera.up,"z")}e+=1},3e3)}}class rt extends H{constructor(t,s,n){super(t,s,n);w(this,"clock",new Se);w(this,"controls");w(this,"mixer",null);w(this,"playRate",1);w(this,"modelReady",!1);w(this,"clipAction");w(this,"texture2dMesh",null);this.controls=new Ce(this.camera,this.renderer.domElement),window.addEventListener("resize",this.onWindowResize,!1)}loadGltf(t,s){Ne(this.renderer).load(t,i=>{const r=new ve().setFromObject(i.scene),o=r.getSize(new z).length(),a=r.getCenter(new z);this.controls.maxDistance=o*10,i.scene.position.x+=i.scene.position.x-a.x,i.scene.position.y+=i.scene.position.y-a.y,i.scene.position.z+=i.scene.position.z-a.z,this.cameraPositionFlag||(this.camera.position.copy(a),this.camera.position.x+=o/2,this.camera.position.y+=o/5,this.camera.position.z+=o/2,this.camera.lookAt(a),this.viewPoint=this.setViewPoint(this.camera,[a.x,a.y,a.z])),this.mixer=new W(i.scene),i.animations.forEach((l,d)=>{var u,m;d===0?this.clipAction=(u=this.mixer)==null?void 0:u.clipAction(l).play():(m=this.mixer)==null||m.clipAction(l).play()}),this.content=i.scene,this.exportContent.copy(i.scene),this.exportContent.animations=i.animations,this.scene.add(i.scene),this.modelReady=!0,s&&s(i.scene)},i=>{})}loadVtk(t){Le(t,this.scene,this.content)}loadVtks(t){let s=0,{vtkLoader:n}=q();const i=new _e,r=setInterval(()=>{s===t.length&&(this.scene.add(this.exportContent),this.mixer=new W(i),this.exportContent.animations.forEach(a=>{var d;const l=(d=this.mixer)==null?void 0:d.clipAction(a);l.timeScale=3,l.play()}),this.modelReady=!0,clearInterval(r))},100);t.forEach(a=>{const l=[];a.urls.forEach((d,u)=>{n.load(d,m=>{m.center(),m.computeVertexNormals(),m.name=u.toString(),l.push(m),l.length===a.urls.length&&(l.sort((h,f)=>this.sort?parseInt(h.name)-parseInt(f.name):parseInt(f.name)-parseInt(h.name)),o(l,a),s+=1)})})});const o=(a,l)=>{let{vtkmaterial:d}=q(l.opts),u=a[0];u.attributes.position,a.forEach((x,R)=>{R===0?(u=x,u.morphAttributes.position=[]):u.morphAttributes.position.push(x.attributes.position)});const m=new Fe(u,d);m.scale.multiplyScalar(.1),i.add(m),this.exportContent.add(i),m.morphTargetInfluences=[],m.name=l.name;let h=0,f=[],p=a.length-1;for(let x=0;x<p;x++){const R=new Pe(`${m.name}.morphTargetInfluences[${x}]`,[h,h+1,h+2],[0,1,0]);f.push(R),h=h+2}const g=new Ue(`copper3d_heart_morph_${m.name}`,p,f);this.exportContent.animations.push(g)}}texture2d(t){ze(t,this.scene);const s=setInterval(()=>{var n;this.scene.children.forEach(i=>{if(i.isMesh&&i.name==="texture2d_mesh_zip"){this.texture2dMesh=i;const r=()=>{if(this.texture2dMesh){let o=this.texture2dMesh.material.uniforms.depth.value;o+=this.depthStep,(o>109||o<0)&&(o>1&&(o=109*2-o),o<0&&(o=-o),this.depthStep=-this.depthStep),this.texture2dMesh.material.uniforms.depth.value=o}};this.addPreRenderCallbackFunction(r)}}),((n=this.texture2dMesh)==null?void 0:n.name)==="texture2d_mesh_zip"&&clearInterval(s)},500)}getPlayRate(){return this.playRate}setPlayRate(t){this.playRate=t}setModelPosition(t,s){s.x&&(t.position.x=s.x),s.y&&(t.position.y=s.y),s.z&&(t.position.z=s.z)}resetView(){this.controls.reset(),this.updateCamera(this.viewPoint)}updateCamera(t){this.cameraPositionFlag=!0,this.copperControl.updateCameraViewPoint(t)}getCurrentTime(){let t=0;return this.clipAction&&(t=this.clipAction.time/this.clipAction._clip.duration),t}getCurrentMixer(){return this.mixer}render(){this.controls.update(),this.modelReady&&this.mixer&&this.mixer.update(this.clock.getDelta()*this.playRate),Object.values(this.preRenderCallbackFunctions.cache).forEach(t=>{t&&t.call(null)}),this.subDiv&&this.subCamera&&this.subRender&&(this.subCamera.aspect=this.subDiv.clientWidth/this.subDiv.clientHeight,this.subCamera.updateProjectionMatrix(),this.subRender.setSize(this.subDiv.clientWidth,this.subDiv.clientHeight),this.subCamera.position.copy(this.camera.position),this.subCamera.lookAt(this.subScene.position),this.subRender.render(this.subScene,this.subCamera)),this.renderer.render(this.scene,this.camera)}}class ct extends it{constructor(t,s){super(t,s);w(this,"sceneMap",{});w(this,"animate",()=>{this.render(),this.stats.update(),requestAnimationFrame(this.animate)})}getSceneByName(t){return this.sceneMap[t]}setCurrentScene(t){var s;t&&(this.currentScene=t,(s=this.options)!=null&&s.guiOpen&&this.updateGui(),this.onWindowResize())}createScene(t){var s;if(this.sceneMap[t]==null){const n=!!((s=this.options)!=null&&s.alpha),i=new rt(this.container,this.renderer,n);return i.sceneName=t,this.updateEnvironment(i.vignette),this.sceneMap[t]=i,i}}onWindowResize(){}render(){this.currentScene.render()}}export{ct as c};
