var b=Object.defineProperty;var S=(l,e,t)=>e in l?b(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var s=(l,e,t)=>(S(l,typeof e!="symbol"?e+"":e,t),t);import{r as v,W as F,t as x,u as y,v as w,b as E,w as G,x as k}from"./index.4ecf1bb4.js";import{G as L}from"./dat.gui.module.6914edc7.js";class M{constructor(e){s(this,"gltfExporter",new v);s(this,"options",{trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!1,maxTextureSize:4096e7,animations:[]});s(this,"link");Object.assign(this.options,e),this.link=document.createElement("a"),this.link.style.display="none",document.body.appendChild(this.link)}export(e){const t=e.name?e.name:"export";this.gltfExporter.parse(e,r=>{if(r instanceof ArrayBuffer)this.saveArrayBuffer(r,t+".glb");else{const n=JSON.stringify(r,null,2);this.saveString(n,t+".gltf")}},function(r){console.log("An error happened during parsing",r)},this.options)}save(e,t){this.link.href=URL.createObjectURL(e),this.link.download=t,this.link.click()}saveString(e,t){this.save(new Blob([e],{type:"text/plain"}),t)}saveArrayBuffer(e,t){this.save(new Blob([e],{type:"application/octet-stream"}),t)}}class _{constructor(e,t){s(this,"container");s(this,"renderer");s(this,"gui");s(this,"stats");s(this,"currentScene");s(this,"pmremGenerator");s(this,"options");s(this,"state");s(this,"visualiseFolder");s(this,"visualCtrls",[]);s(this,"cameraFolder");s(this,"exporter",null);this.container=e,this.options=t,this.renderer=new F({antialias:!0}),this.renderer.physicallyCorrectLights=!0,this.renderer.outputEncoding=x,this.gui=null,this.stats=y(),this.pmremGenerator=new w(this.renderer),this.pmremGenerator.compileEquirectangularShader(),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.currentScene=new E(this.container,this.renderer),this.currentScene.sceneName="default",this.updateEnvironment(this.currentScene.vignette),this.state={playbackSpeed:1,wireframe:!1,skeleton:!1,grid:!1,addLights:!0,exposure:1,ambientIntensity:.3,ambientColor:2105376,directIntensity:.8*Math.PI,directColor:16777215,bgColor1:"#5454ad",bgColor2:"#18e5a7",exportGltf:()=>{this.exporter||(this.exporter=new M({animations:this.currentScene.exportContent.animations})),this.exporter.export(this.currentScene.exportContent)}},this.visualiseFolder=null,this.cameraFolder=null,this.init()}init(){var e;this.currentScene.sceneName===""&&(this.currentScene.sceneName="default"),((e=this.options)==null?void 0:e.guiOpen)&&!this.gui&&this.addGui(),[].forEach.call(this.stats.dom.children,t=>t.style.display=""),this.container.appendChild(this.renderer.domElement)}updateEnvironment(e){const t=G.filter(r=>r.name==="Venice Sunset")[0];this.getCubeMapTexture(t).then(r=>{const n=this.getCurrentScene();r&&e&&(n==null||n.scene.add(e.mesh)),n.scene.environment=r,n.scene.background=r})}getCubeMapTexture(e){const{path:t}=e;return t?new Promise((r,n)=>{new k().load(t,h=>{const d=this.pmremGenerator.fromEquirectangular(h).texture;this.pmremGenerator.dispose(),r(d)},void 0,n)}):Promise.resolve({envMap:null})}getCurrentScene(){return this.currentScene}hideGui(){this.gui&&this.gui.hide()}closeGui(){this.gui&&(this.gui.closed=!0)}addGui(){var d,u,p;const e=this.gui=new L({width:260}),t=e.addFolder("Visualisation settings");t.add(this.state,"wireframe").onChange(()=>this.currentScene.updateDisplay(this.state)),this.visualiseFolder=t.addFolder("ModelVisualisation");const n=t.addColor(this.state,"bgColor1"),h=t.addColor(this.state,"bgColor2");if(n.onChange(()=>this.currentScene.updateBackground(this.state.bgColor1,this.state.bgColor2)),h.onChange(()=>this.currentScene.updateBackground(this.state.bgColor1,this.state.bgColor2)),(d=this.options)!=null&&d.camera&&(this.cameraFolder=e.addFolder("Camera")),(u=this.options)!=null&&u.performance){const a=e.addFolder("Performance"),o=document.createElement("li");this.stats.dom.style.position="static",o.appendChild(this.stats.dom),o.style.height="50px",a.__ul.appendChild(o)}if((p=this.options)!=null&&p.light){const a=e.addFolder("LightsFolder");[a.add(this.state,"addLights").listen(),a.add(this.state,"ambientIntensity",0,2),a.addColor(this.state,"ambientColor"),a.add(this.state,"directIntensity",0,4),a.addColor(this.state,"directColor")].forEach(o=>o.onChange(()=>this.currentScene.updateLights(this.state)))}e.add(this.state,"exportGltf")}updateGui(){this.visualCtrls.length!==0&&this.visualCtrls.forEach(e=>{var t;(t=this.visualiseFolder)==null||t.remove(e)}),this.visualCtrls=[],setTimeout(()=>{var r,n,h,d,u,p,a,o;let e=[];(r=this.currentScene.content)==null||r.children;const t=i=>{if(i.isMesh){const c={name:i.name||"Untitled",visible:i.visible,mesh:i};e.push(c)}};if((n=this.currentScene.content)==null||n.traverse(i=>{i.isMesh&&t(i)}),e.forEach(i=>{const c=this.visualiseFolder.add(i,"visible").name(i.name).onChange(()=>{this.currentScene.updateModelChildrenVisualisation(i.mesh)});this.visualCtrls.push(c)}),this.cameraFolder){if(this.cameraFolder.__controllers.length>0){const m=[];this.cameraFolder.__controllers.forEach(g=>{m.push(g)}),m.forEach(g=>{var C;(C=this.cameraFolder)==null||C.remove(g)})}(h=this.cameraFolder)==null||h.add(this.currentScene.camera,"near"),(d=this.cameraFolder)==null||d.add(this.currentScene.camera,"far");const i=(u=this.cameraFolder)==null?void 0:u.__folders;for(let m in i)if(Object.prototype.hasOwnProperty.call(i,m)){const g=i[m];(p=this.cameraFolder)==null||p.removeFolder(g)}const c=(a=this.cameraFolder)==null?void 0:a.addFolder("position");c.add(this.currentScene.camera.position,"x"),c.add(this.currentScene.camera.position,"y"),c.add(this.currentScene.camera.position,"z");const f=(o=this.cameraFolder)==null?void 0:o.addFolder("up");f.add(this.currentScene.camera.up,"x"),f.add(this.currentScene.camera.up,"y"),f.add(this.currentScene.camera.up,"z")}},1500)}}export{_ as b};
