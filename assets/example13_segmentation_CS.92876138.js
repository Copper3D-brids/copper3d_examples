var be=Object.defineProperty;var Ee=(s,t,e)=>t in s?be(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var w=(s,t,e)=>(Ee(s,typeof t!="symbol"?t+"":t,e),e);import{b as kt,F as Nt,d as Ae,V as Oe,e as Rt,t as zt,G as De,c as Le,l as ke,f as Ne,s as Re}from"./index.f9f4e8f8.js";import{d as Ct,j as ze,t as Te,r as L,w as mt,c as vt,a as I,k as V,l as U,m as gt,o as St,p as Yt,b as $t,_ as qt,n as lt,q as Me,s as Fe,v as Ue,e as He}from"./index.7fc10c3f.js";import"./___vite-browser-external_commonjs-proxy.048ed359.js";function ht(s,t){if(!!kt&&!!Nt)Nt.saveAs(s,t);else if(kt)Ae.exports.saveAs(s,t);else{var e=require("file-saver");e.saveAs(s,t)}}class Be{constructor(t){w(this,"container");w(this,"paintImages",{x:[],y:[],z:[]});w(this,"allSlicesArray",[]);w(this,"displaySlices",[]);w(this,"backUpDisplaySlices",[]);w(this,"skipSlicesDic",{});w(this,"axis","z");w(this,"mainAreaContainer",document.createElement("div"));w(this,"showDragNumberDiv",document.createElement("div"));w(this,"drawingCanvas",document.createElement("canvas"));w(this,"displayCanvas",document.createElement("canvas"));w(this,"downloadCanvas",document.createElement("canvas"));w(this,"emptyCanvas",document.createElement("canvas"));w(this,"downloadImage",document.createElement("a"));w(this,"drawingCanvasLayerOne",document.createElement("canvas"));w(this,"currentShowingSlice");w(this,"displayCtx");w(this,"drawingCtx");w(this,"emptyCtx");w(this,"drawingLayerOneCtx");w(this,"originCanvas");w(this,"mainPreSlice");w(this,"sceneIn");w(this,"Is_Shift_Pressed",!1);w(this,"Is_Draw",!1);w(this,"sensitiveArray",[]);w(this,"handleWheelMove",()=>{});w(this,"start",()=>{});w(this,"paintedImage");w(this,"previousDrawingImage");w(this,"undoArray",[]);w(this,"initState",!0);w(this,"preTimer");w(this,"nrrd_states",{originWidth:0,originHeight:0,nrrd_x_pixel:0,nrrd_y_pixel:0,nrrd_z_pixel:0,nrrd_x_centimeter:0,nrrd_y_centimeter:0,nrrd_z_centimeter:0,changedWidth:0,changedHeight:0,oldIndex:0,currentIndex:0,maxIndex:0,minIndex:0,RSARatio:0,voxelSpacing:[],spaceOrigin:[],dimensions:[],loadMaskJson:!1,ratios:{x:1,y:1,z:1},sharedPlace:{x:[-1],y:[-1],z:[-1]},latestNotEmptyImg:new Image,contrastNum:0,Max_sensitive:100,readyToUpdate:!0,showContrast:!1,enableCursorChoose:!1,isCursorSelect:!1,cursorPageX:0,cursorPageY:0,Mouse_Over_x:0,Mouse_Over_y:0,Mouse_Over:!1,stepClear:1,sizeFoctor:1,getMasks:(t,e,r,i)=>{},defaultPaintCursor:"url(https://raw.githubusercontent.com/LinkunGao/copper3d-datasets/main/icons/dot.svg) 12 12,auto",drawStartPos:new Oe(1,1)});w(this,"cursorPage",{x:{cursorPageX:0,cursorPageY:0,index:0,updated:!1},y:{cursorPageX:0,cursorPageY:0,index:0,updated:!1},z:{cursorPageX:0,cursorPageY:0,index:0,updated:!1}});w(this,"gui_states",{mainAreaSize:1,dragSensitivity:75,Eraser:!1,globalAlpha:.7,lineWidth:2,color:"#f50a33",segmentation:!0,fillColor:"#3fac58",brushColor:"#3fac58",brushAndEraserSize:15,cursor:"dot",clear:()=>{this.clearPaint()},clearAll:()=>{confirm("Are you sure remove annotations on All slice?")===!0&&(this.clearPaint(),this.clearStoreImages())},undo:()=>{this.undoLastPainting()},downloadCurrentMask:()=>{this.enableDownload()},resetZoom:()=>{this.nrrd_states.sizeFoctor=1,this.resizePaintArea(1),this.resetPaintArea()},subView:!1,subViewScale:1,resetView:()=>{var t;(t=this.sceneIn)==null||t.resetView()},exportMarks:()=>{this.exportData()}});w(this,"drawLine",(t,e,r,i)=>{this.drawingCtx.beginPath(),this.drawingCtx.moveTo(t,e),this.drawingCtx.lineTo(r,i),this.drawingCtx.strokeStyle=this.gui_states.color,this.drawingCtx.stroke()});this.container=t,this.displayCtx=this.displayCanvas.getContext("2d"),this.drawingCtx=this.drawingCanvas.getContext("2d"),this.emptyCtx=this.emptyCanvas.getContext("2d"),this.drawingLayerOneCtx=this.drawingCanvasLayerOne.getContext("2d"),this.previousDrawingImage=this.emptyCtx.createImageData(1,1),this.init()}init(){this.showDragNumberDiv=this.createShowSliceNumberDiv(),this.mainAreaContainer.classList.add("copper3D_drawingCanvasContainer"),this.container.appendChild(this.mainAreaContainer),this.autoFocusDiv(this.container),this.downloadImage.href="",this.downloadImage.target="_blank";for(let t=0;t<this.nrrd_states.Max_sensitive;t++)this.sensitiveArray.push((t+1)/20);this.container.addEventListener("keydown",t=>{t.key==="Shift"&&(this.Is_Shift_Pressed=!0,this.nrrd_states.enableCursorChoose=!1),t.key==="s"&&(this.Is_Draw=!1,this.nrrd_states.enableCursorChoose=!this.nrrd_states.enableCursorChoose)}),this.container.addEventListener("keyup",t=>{t.key==="Shift"&&(this.Is_Shift_Pressed=!1)})}setAllSlices(t){this.allSlicesArray=[...t],this.nrrd_states.nrrd_x_pixel=this.allSlicesArray[0].z.canvas.width,this.nrrd_states.nrrd_y_pixel=this.allSlicesArray[0].z.canvas.height,this.nrrd_states.nrrd_z_pixel=this.allSlicesArray[0].x.canvas.width,this.nrrd_states.nrrd_x_centimeter=this.allSlicesArray[0].x.volume.dimensions[0],this.nrrd_states.nrrd_y_centimeter=this.allSlicesArray[0].x.volume.dimensions[1],this.nrrd_states.nrrd_z_centimeter=this.allSlicesArray[0].x.volume.dimensions[2],this.nrrd_states.dimensions=this.allSlicesArray[0].x.volume.dimensions,this.nrrd_states.voxelSpacing=this.allSlicesArray[0].x.volume.spacing,this.allSlicesArray.forEach((e,r)=>{e.x.contrastOrder=r,e.y.contrastOrder=r,e.z.contrastOrder=r}),this.nrrd_states.spaceOrigin=this.allSlicesArray[0].x.volume.header.space_origin.map(e=>e*1),this.nrrd_states.sharedPlace.x=this.getSharedPlace(this.nrrd_states.dimensions[0],this.nrrd_states.ratios.x),this.nrrd_states.sharedPlace.y=this.getSharedPlace(this.nrrd_states.dimensions[1],this.nrrd_states.ratios.y),this.nrrd_states.sharedPlace.z=this.getSharedPlace(this.nrrd_states.dimensions[2],this.nrrd_states.ratios.z),this.initPaintImages(this.nrrd_states.dimensions),this.setDisplaySlicesBaseOnAxis(),this.afterLoadSlice()}setMasksData(t,e){if(this.nrrd_states.loadMaskJson=!0,e){let{loadingContainer:i,progress:a}=e;i.style.display="flex",a.innerText="Loading masks data......"}this.setEmptyCanvasSize();let r=this.emptyCtx.createImageData(this.nrrd_states.nrrd_x_centimeter,this.nrrd_states.nrrd_y_centimeter);t.forEach((i,a)=>{this.setEmptyCanvasSize();for(let n=0;n<i.data.length;n++)r.data[n]=i.data[n];this.emptyCtx.putImageData(r,0,0),this.storeAllImages(a)}),this.nrrd_states.loadMaskJson=!1,this.gui_states.resetZoom(),e&&(e.loadingContainer.style.display="none")}getCurrentImageDimension(){return this.nrrd_states.dimensions}getSharedPlace(t,e){let r=-1,i=[],a=new Set;for(let n=0;n<t;n++){const o=Math.floor(n*e);o===r?(a.add(n-1),a.add(n)):r=o}return a.forEach(n=>{i.push(n)}),i}initPaintImages(t){for(let e=0;e<t[0];e++){const r=this.emptyCtx.createImageData(this.nrrd_states.nrrd_z_centimeter,this.nrrd_states.nrrd_y_centimeter),i={index:e,image:r};this.paintImages.x.push(i)}for(let e=0;e<t[1];e++){const r=this.emptyCtx.createImageData(this.nrrd_states.nrrd_x_centimeter,this.nrrd_states.nrrd_z_centimeter),i={index:e,image:r};this.paintImages.y.push(i)}for(let e=0;e<t[2];e++){const r=this.emptyCtx.createImageData(this.nrrd_states.nrrd_x_centimeter,this.nrrd_states.nrrd_y_centimeter),i={index:e,image:r};this.paintImages.z.push(i)}}setSliceOrientation(t){this.nrrd_states.enableCursorChoose&&(this.axis==="z"?(this.cursorPage.z.index=this.nrrd_states.currentIndex,this.cursorPage.z.cursorPageX=this.nrrd_states.cursorPageX,this.cursorPage.z.cursorPageY=this.nrrd_states.cursorPageY):this.axis==="x"?(this.cursorPage.x.index=this.nrrd_states.currentIndex,this.cursorPage.x.cursorPageX=this.nrrd_states.cursorPageX,this.cursorPage.x.cursorPageY=this.nrrd_states.cursorPageY):this.axis==="y"&&(this.cursorPage.y.index=this.nrrd_states.currentIndex,this.cursorPage.y.cursorPageX=this.nrrd_states.cursorPageX,this.cursorPage.y.cursorPageY=this.nrrd_states.cursorPageY),t==="z"?this.nrrd_states.isCursorSelect&&!this.cursorPage.z.updated?(this.axis==="x"&&(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=Math.ceil(this.cursorPage.x.cursorPageX/this.nrrd_states.nrrd_z_pixel*this.nrrd_states.dimensions[2]),this.nrrd_states.cursorPageX=Math.ceil(this.cursorPage.x.index/this.nrrd_states.dimensions[0]*this.nrrd_states.nrrd_x_pixel)),this.axis==="y"&&(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=Math.ceil(this.cursorPage.y.cursorPageY/this.nrrd_states.nrrd_z_pixel*this.nrrd_states.dimensions[2]),this.nrrd_states.cursorPageY=Math.ceil(this.cursorPage.y.index/this.nrrd_states.dimensions[1]*this.nrrd_states.nrrd_y_pixel)),this.cursorPage.z.updated=!0):(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=this.cursorPage.z.index,this.nrrd_states.cursorPageX=this.cursorPage.z.cursorPageX,this.nrrd_states.cursorPageY=this.cursorPage.z.cursorPageY):t==="x"?this.nrrd_states.isCursorSelect&&!this.cursorPage.x.updated?(this.axis==="z"&&(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=Math.ceil(this.cursorPage.z.cursorPageX/this.nrrd_states.nrrd_x_pixel*this.nrrd_states.dimensions[0]),this.nrrd_states.cursorPageX=Math.floor(this.cursorPage.z.index/this.nrrd_states.dimensions[2]*this.nrrd_states.nrrd_z_pixel)),this.axis==="y"&&(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=Math.ceil(this.cursorPage.y.cursorPageX/this.nrrd_states.nrrd_y_pixel*this.nrrd_states.dimensions[1]),this.nrrd_states.cursorPageX=this.cursorPage.y.cursorPageY,this.nrrd_states.cursorPageY=Math.ceil(this.cursorPage.y.index/this.nrrd_states.dimensions[1]*this.nrrd_states.nrrd_y_pixel)),this.cursorPage.x.updated=!0):(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=this.cursorPage.x.index,this.nrrd_states.cursorPageX=this.cursorPage.x.cursorPageX,this.nrrd_states.cursorPageY=this.cursorPage.x.cursorPageY):t==="y"&&(this.nrrd_states.isCursorSelect&&!this.cursorPage.y.updated?(this.axis==="z"&&(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=Math.ceil(this.cursorPage.z.cursorPageY/this.nrrd_states.nrrd_y_pixel*this.nrrd_states.dimensions[1]),this.nrrd_states.cursorPageY=Math.ceil(this.cursorPage.z.index/this.nrrd_states.dimensions[2]*this.nrrd_states.nrrd_z_pixel)),this.axis==="x"&&(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=Math.ceil(this.cursorPage.x.cursorPageY/this.nrrd_states.nrrd_x_pixel*this.nrrd_states.dimensions[0]),this.nrrd_states.cursorPageX=Math.ceil(this.cursorPage.x.index/this.nrrd_states.dimensions[0]*this.nrrd_states.nrrd_x_pixel),this.nrrd_states.cursorPageY=this.cursorPage.x.cursorPageX),this.cursorPage.y.updated=!0):(this.nrrd_states.oldIndex=this.nrrd_states.currentIndex=this.cursorPage.y.index,this.nrrd_states.cursorPageX=this.cursorPage.y.cursorPageX,this.nrrd_states.cursorPageY=this.cursorPage.y.cursorPageY)),this.cursorPage.x.updated&&this.cursorPage.y.updated&&this.cursorPage.z.updated&&(this.nrrd_states.isCursorSelect=!1)),this.axis=t,this.resetDisplaySlicesStatus()}addSkip(t){this.skipSlicesDic[t]=this.backUpDisplaySlices[t],t>=this.displaySlices.length?this.nrrd_states.contrastNum=this.displaySlices.length:this.nrrd_states.contrastNum=t,this.resetDisplaySlicesStatus()}removeSkip(t){this.skipSlicesDic[t]=void 0,this.nrrd_states.contrastNum=0,this.resetDisplaySlicesStatus()}clear(){this.allSlicesArray.length=0,this.displaySlices.length=0,this.undoArray.length=0,this.paintImages.x.length=0,this.paintImages.y.length=0,this.paintImages.z.length=0,this.clearDictionary(this.skipSlicesDic),this.backUpDisplaySlices.length=0,this.mainPreSlice=void 0,this.currentShowingSlice=void 0,this.previousDrawingImage=this.emptyCtx.createImageData(1,1),this.initState=!0,this.axis="z",this.nrrd_states.sizeFoctor=1,this.drawingCanvasLayerOne.width=this.drawingCanvasLayerOne.width,this.drawingCanvas.width=this.drawingCanvas.width,this.displayCanvas.width=this.displayCanvas.width}setSliceMoving(t){this.mainPreSlice&&(this.Is_Draw=!0,this.setSyncsliceNum(),this.updateIndex(t),this.setIsDrawFalse(1e3))}setShowInMainArea(t){this.nrrd_states.showContrast=t,this.nrrd_states.contrastNum=0,this.mainPreSlice&&(this.redrawMianPreOnDisplayCanvas(),this.updateShowNumDiv(this.nrrd_states.contrastNum))}setMainAreaSize(t){this.nrrd_states.sizeFoctor+=t,this.nrrd_states.sizeFoctor>=8?this.nrrd_states.sizeFoctor=8:this.nrrd_states.sizeFoctor<=1&&(this.nrrd_states.sizeFoctor=1),this.resizePaintArea(this.nrrd_states.sizeFoctor),this.resetPaintArea(),this.setIsDrawFalse(1e3)}getMaxSliceNum(){return this.nrrd_states.showContrast?[this.nrrd_states.maxIndex,this.nrrd_states.maxIndex*this.displaySlices.length]:[this.nrrd_states.maxIndex]}getCurrentSlicesNumAndContrastNum(){return{currentIndex:this.nrrd_states.currentIndex,contrastIndex:this.nrrd_states.contrastNum}}getCurrentSliceIndex(){return Math.ceil(this.mainPreSlice.index)}getIsShowContrastState(){return this.nrrd_states.showContrast}setIsDrawFalse(t){this.preTimer=setTimeout(()=>{this.Is_Draw=!1,this.preTimer&&(window.clearTimeout(this.preTimer),this.preTimer=void 0)},t)}setDisplaySlicesBaseOnAxis(){this.displaySlices.length=0,this.backUpDisplaySlices.length=0,this.allSlicesArray.forEach(t=>{this.backUpDisplaySlices.push(t[this.axis])}),this.loadDisplaySlicesArray()}loadDisplaySlicesArray(){const t=Object.values(this.skipSlicesDic);t.length===0?this.backUpDisplaySlices.forEach((e,r)=>{this.skipSlicesDic[r]=e,this.displaySlices.push(e)}):t.forEach((e,r)=>{e&&(this.displaySlices.push(this.backUpDisplaySlices[r]),this.skipSlicesDic[r]=this.backUpDisplaySlices[r])})}resetDisplaySlicesStatus(){this.setDisplaySlicesBaseOnAxis(),this.setupConfigs()}setupConfigs(){this.setMainPreSlice(),this.updateMaxIndex(),this.setOriginCanvasAndPre(),this.updateShowNumDiv(this.nrrd_states.contrastNum),this.repraintCurrentContrastSlice(),this.resizePaintArea(this.nrrd_states.sizeFoctor),this.resetPaintArea()}setMainPreSlice(){this.mainPreSlice=this.displaySlices[0],this.mainPreSlice&&(this.nrrd_states.RSARatio=this.mainPreSlice.RSARatio)}setOriginCanvasAndPre(){this.mainPreSlice&&(this.nrrd_states.oldIndex>this.nrrd_states.maxIndex&&(this.nrrd_states.oldIndex=this.nrrd_states.maxIndex),this.initState?(this.nrrd_states.oldIndex=this.mainPreSlice.initIndex,this.nrrd_states.currentIndex=this.mainPreSlice.initIndex):this.mainPreSlice.index=this.nrrd_states.oldIndex,this.originCanvas=this.mainPreSlice.canvas,this.updateOriginAndChangedWH())}afterLoadSlice(){this.setMainPreSlice(),this.setOriginCanvasAndPre(),this.currentShowingSlice=this.mainPreSlice,this.undoArray=[{sliceIndex:this.mainPreSlice.index,undos:[]}],this.nrrd_states.oldIndex=this.mainPreSlice.initIndex,this.nrrd_states.currentIndex=this.mainPreSlice.initIndex,this.updateMaxIndex(),this.updateShowNumDiv(this.nrrd_states.contrastNum),this.initState=!1}updateMaxIndex(){this.mainPreSlice&&(this.nrrd_states.maxIndex=this.mainPreSlice.MaxIndex)}updateCurrentContrastSlice(){return this.currentShowingSlice=this.displaySlices[this.nrrd_states.contrastNum],this.currentShowingSlice}createShowSliceNumberDiv(){const t=document.createElement("div");return t.className="copper3d_sliceNumber",t.style.position="absolute",t.style.zIndex="100",t.style.top="20px",t.style.left="100px",t}updateOriginAndChangedWH(){this.nrrd_states.originWidth=this.originCanvas.width,this.nrrd_states.originHeight=this.originCanvas.height,this.nrrd_states.changedWidth=this.nrrd_states.originWidth*Number(this.gui_states.mainAreaSize),this.nrrd_states.changedHeight=this.nrrd_states.originWidth*Number(this.gui_states.mainAreaSize),this.resizePaintArea(1),this.resetPaintArea()}initAllCanvas(){this.displayCanvas.style.position="absolute",this.displayCanvas.style.zIndex="9",this.displayCanvas.width=this.nrrd_states.changedWidth,this.displayCanvas.height=this.nrrd_states.changedHeight,this.drawingCanvas.style.zIndex="10",this.drawingCanvas.style.position="absolute",this.drawingCanvas.width=this.nrrd_states.changedWidth,this.drawingCanvas.height=this.nrrd_states.changedHeight,this.drawingCanvas.style.cursor=this.nrrd_states.defaultPaintCursor,this.drawingCanvas.oncontextmenu=()=>!1,this.drawingCanvasLayerOne.width=this.nrrd_states.changedWidth,this.drawingCanvasLayerOne.height=this.nrrd_states.changedHeight,this.mainAreaContainer.style.width=this.nrrd_states.originWidth*8+"px",this.mainAreaContainer.style.height=this.nrrd_states.originHeight*8+"px",this.mainAreaContainer.appendChild(this.displayCanvas),this.mainAreaContainer.appendChild(this.drawingCanvas)}autoFocusDiv(t){t.tabIndex=10,t.addEventListener("mouseover",()=>{t.focus()}),t.style.outline="none"}setSyncsliceNum(){this.displaySlices.forEach((t,e)=>{e!==0&&(t.index=this.mainPreSlice.index)})}repraintCurrentContrastSlice(){this.setSyncsliceNum(),this.displaySlices.forEach((t,e)=>{t.repaint.call(t)})}repraintAllContrastSlices(){this.displaySlices.forEach((t,e)=>{t.volume.repaintAllSlices()})}updateShowNumDiv(t){this.mainPreSlice&&(this.nrrd_states.currentIndex>this.nrrd_states.maxIndex&&(this.nrrd_states.currentIndex=this.nrrd_states.maxIndex),this.nrrd_states.showContrast?this.showDragNumberDiv.innerHTML=`ContrastNum: ${t}/${this.displaySlices.length-1} SliceNum: ${this.nrrd_states.currentIndex}/${this.nrrd_states.maxIndex}`:this.showDragNumberDiv.innerHTML=`SliceNum: ${this.nrrd_states.currentIndex}/${this.nrrd_states.maxIndex}`)}appendLoadingbar(t){this.mainAreaContainer.appendChild(t)}drag(t){let e,r,i=this.container.offsetHeight,a=1,n,o,c;this.sensitiveArray.reverse(),t!=null&&t.showNumber&&this.container.appendChild(this.showDragNumberDiv),o=h=>{this.drawingCanvas.removeEventListener("wheel",this.handleWheelMove),h.button===0&&(this.setSyncsliceNum(),r=h.offsetY/i,this.container.addEventListener("pointermove",c,!1),a=this.sensitiveArray[this.gui_states.dragSensitivity-1])},c=zt(h=>{r-h.offsetY/i>=0?e=-Math.ceil((r-h.offsetY/i)*10/a):e=-Math.floor((r-h.offsetY/i)*10/a),this.updateIndex(e),t!=null&&t.getSliceNum&&t.getSliceNum(this.nrrd_states.currentIndex,this.nrrd_states.contrastNum),r=h.offsetY/i},a*200),n=h=>{this.drawingCanvas.addEventListener("wheel",this.handleWheelMove),this.setSyncsliceNum(),this.container.removeEventListener("pointermove",c,!1)};const d=()=>{this.container.style.cursor="pointer",this.container.addEventListener("pointerdown",o,!0),this.container.addEventListener("pointerup",n,!0)};d(),this.container.addEventListener("keydown",h=>{h.key==="Shift"&&(this.container.style.cursor="",this.container.removeEventListener("pointerdown",o,!0),this.container.removeEventListener("pointerup",n,!1),this.setIsDrawFalse(1e3))}),this.container.addEventListener("keyup",h=>{h.key==="Shift"&&d()})}updateIndex(t){let e=0,r=0;this.nrrd_states.showContrast?(r=t%this.displaySlices.length,this.nrrd_states.contrastNum+=r,t>0?this.mainPreSlice.index<=this.nrrd_states.maxIndex?(e=Math.floor(t/this.displaySlices.length),this.nrrd_states.contrastNum>this.displaySlices.length-1&&(e+=1,this.nrrd_states.contrastNum-=this.displaySlices.length)):e=0:(e=Math.ceil(t/this.displaySlices.length),this.nrrd_states.contrastNum<0&&(this.nrrd_states.contrastNum+=this.displaySlices.length,e-=1))):e=t;let i=this.nrrd_states.oldIndex+e;if(i!=this.nrrd_states.oldIndex||this.nrrd_states.showContrast){if(i>this.nrrd_states.maxIndex)i=this.nrrd_states.maxIndex,this.nrrd_states.contrastNum=4;else if(i<this.nrrd_states.minIndex)i=this.nrrd_states.minIndex,this.nrrd_states.contrastNum=0;else{this.mainPreSlice.index=i,this.nrrd_states.currentIndex=i,i!=this.nrrd_states.oldIndex&&(this.drawingCanvasLayerOne.width=this.drawingCanvasLayerOne.width),this.displayCanvas.width=this.displayCanvas.width,this.nrrd_states.changedWidth===0&&(this.nrrd_states.changedWidth=this.nrrd_states.originWidth,this.nrrd_states.changedHeight=this.nrrd_states.originHeight);let a=this.updateCurrentContrastSlice();a.repaint.call(a),this.drawDragSlice(a.canvas,i)}this.nrrd_states.oldIndex=i,this.updateShowNumDiv(this.nrrd_states.contrastNum)}}drawDragSlice(t,e){var r;this.displayCtx.save(),this.flipDisplayImageByAxis(),this.displayCtx.drawImage(t,0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight),this.displayCtx.restore(),(this.paintImages.x.length>0||this.paintImages.y.length>0||this.paintImages.z.length>0)&&e!=this.nrrd_states.oldIndex&&(this.paintedImage=this.filterDrawedImage(this.axis,this.nrrd_states.currentIndex),(r=this.paintedImage)!=null&&r.image&&(this.setEmptyCanvasSize(),this.emptyCtx.putImageData(this.paintedImage.image,0,0),this.drawingLayerOneCtx.drawImage(this.emptyCanvas,0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight)))}draw(t,e,r){let i,a;r&&(this.nrrd_states.getMasks=r==null?void 0:r.getMaskData),this.sceneIn=t,t.controls.enabled=!1,this.gui_states.subView===!1&&t.subDiv&&(t.subDiv.style.display="none"),i=e.addFolder("Mode Parameters"),t.subDiv&&(a=e.addFolder("Sub View"),a.add(this.gui_states,"resetView"),a.add(this.gui_states,"subView").onChange(n=>{n?(t.controls.enabled=!0,t.subDiv&&(t.subDiv.style.display="block")):(t.subDiv&&(t.subDiv.style.display="none"),t.controls.enabled=!1)}),a.add(this.gui_states,"subViewScale").min(.25).max(2).step(.01).onFinishChange(n=>{t.subDiv&&(t.subDiv.style.width=200*n+"px"),t.subDiv&&(t.subDiv.style.height=200*n+"px")})),this.paintOnCanvas(i)}paintOnCanvas(t){var f,g,S,_;let e=!1,r=!1,i=0,a=0,n=this.mainPreSlice.index,o=!1,c=[];this.updateOriginAndChangedWH(),this.initAllCanvas(),this.configGui(t),(f=this.displayCtx)==null||f.save(),this.flipDisplayImageByAxis(),(g=this.displayCtx)==null||g.drawImage(this.originCanvas,0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight),(S=this.displayCtx)==null||S.restore(),this.previousDrawingImage=this.drawingCtx.getImageData(0,0,this.drawingCanvas.width,this.drawingCanvas.height),this.handleWheelMove=this.configMouseWheel((_=this.sceneIn)==null?void 0:_.controls),this.drawingCanvas.addEventListener("wheel",this.handleWheelMove,{passive:!1});const d=zt(p=>{this.drawingCanvas.style.cursor="grabbing",this.displayCanvas.style.left=this.drawingCanvas.style.left=p.clientX-i+"px",this.displayCanvas.style.top=this.drawingCanvas.style.top=p.clientY-a+"px"},80),h=p=>{this.nrrd_states.Mouse_Over_x=p.offsetX,this.nrrd_states.Mouse_Over_y=p.offsetY,this.nrrd_states.Mouse_Over_x===void 0&&(this.nrrd_states.Mouse_Over_x=p.clientX,this.nrrd_states.Mouse_Over_y=p.clientY),p.type==="mouseout"?(this.nrrd_states.Mouse_Over=!1,this.drawingCanvas.removeEventListener("mousemove",h)):p.type==="mouseover"&&(this.nrrd_states.Mouse_Over=!0,this.drawingCanvas.addEventListener("mousemove",h)),p.preventDefault()};this.drawingCanvas.addEventListener("mouseover",h),this.drawingCanvas.addEventListener("mouseout",h),this.drawingCanvas.addEventListener("pointerdown",p=>{if(e||r){this.drawingCanvas.removeEventListener("pointerup",m),this.drawingLayerOneCtx.closePath();return}if(n!==this.mainPreSlice.index&&(this.previousDrawingImage=this.emptyCtx.createImageData(1,1),n=this.mainPreSlice.index),this.drawingCanvas.removeEventListener("wheel",this.handleWheelMove),p.button===0){if(this.Is_Shift_Pressed)e=!0,c=[],o=!0,this.Is_Draw=!0,this.gui_states.Eraser?this.drawingCanvas.style.cursor=Rt(this.gui_states.brushAndEraserSize):this.drawingCanvas.style.cursor=this.nrrd_states.defaultPaintCursor,this.nrrd_states.drawStartPos.set(p.offsetX,p.offsetY),this.drawingLayerOneCtx.beginPath(),this.drawingCanvas.addEventListener("pointerup",m),this.drawingCanvas.addEventListener("pointermove",y);else if(this.nrrd_states.enableCursorChoose)switch(this.nrrd_states.cursorPageX=p.offsetX/this.nrrd_states.sizeFoctor,this.nrrd_states.cursorPageY=p.offsetY/this.nrrd_states.sizeFoctor,this.nrrd_states.isCursorSelect=!0,this.axis){case"x":this.cursorPage.x.updated=!0,this.cursorPage.y.updated=!1,this.cursorPage.z.updated=!1;break;case"y":this.cursorPage.x.updated=!1,this.cursorPage.y.updated=!0,this.cursorPage.z.updated=!1;break;case"z":this.cursorPage.x.updated=!1,this.cursorPage.y.updated=!1,this.cursorPage.z.updated=!0;break}}else if(p.button===2){r=!0;let P=parseInt(this.drawingCanvas.style.left),E=parseInt(this.drawingCanvas.style.top);i=p.clientX-P,a=p.clientY-E,this.drawingCanvas.style.cursor="grab",this.drawingCanvas.addEventListener("pointerup",m),this.drawingCanvas.addEventListener("pointermove",d)}else return},!0);const u=this.useEraser(),y=p=>{this.Is_Draw=!0,o&&(this.gui_states.Eraser?(this.nrrd_states.stepClear=1,u(p.offsetX,p.offsetY,this.gui_states.brushAndEraserSize)):(c.push({x:p.offsetX,y:p.offsetY}),this.paintOnCanvasLayerOne(p.offsetX,p.offsetY)))},m=p=>{var P;if(p.button===0){if(this.Is_Shift_Pressed||o){if(e=!1,this.drawingLayerOneCtx.closePath(),this.drawingCanvas.removeEventListener("pointermove",y),!this.gui_states.Eraser&&this.gui_states.segmentation){this.drawingCanvasLayerOne.width=this.drawingCanvasLayerOne.width;const B=(P=this.filterDrawedImage(this.axis,this.nrrd_states.currentIndex))==null?void 0:P.image;B&&(this.previousDrawingImage=B),this.emptyCanvas.width=this.emptyCanvas.width,this.emptyCtx.putImageData(this.previousDrawingImage,0,0),this.drawingLayerOneCtx.drawImage(this.emptyCanvas,0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight),this.drawingLayerOneCtx.beginPath(),this.drawingLayerOneCtx.moveTo(c[0].x,c[0].y);for(let j=1;j<c.length;j++)this.drawingLayerOneCtx.lineTo(c[j].x,c[j].y);this.drawingLayerOneCtx.closePath(),this.drawingLayerOneCtx.lineWidth=1,this.drawingLayerOneCtx.fillStyle=this.gui_states.fillColor,this.drawingLayerOneCtx.fill()}this.previousDrawingImage=this.drawingLayerOneCtx.getImageData(0,0,this.drawingCanvasLayerOne.width,this.drawingCanvasLayerOne.height),this.storeAllImages(this.nrrd_states.currentIndex);const E=this.drawingCtx.getImageData(0,0,this.drawingCanvas.width,this.drawingCanvas.height);console.log("Paint mark data -----> :",E),o=!1;const q=this.getCurrentUndo(),N=this.drawingCanvasLayerOne.toDataURL(),M=new Image;if(M.src=N,q.length>0)q[0].undos.push(M);else{const B={sliceIndex:this.nrrd_states.currentIndex,undos:[]};B.undos.push(M),this.undoArray.push(B)}}}else if(p.button===2)r=!1,this.drawingCanvas.style.cursor="grab",this.drawingCanvas.removeEventListener("pointermove",d);else return;this.drawingCanvas.addEventListener("wheel",this.handleWheelMove,{passive:!1}),this.gui_states.segmentation||this.setIsDrawFalse(100)};this.drawingCanvas.addEventListener("pointerleave",p=>{o=!1,e&&(e=!1,this.drawingLayerOneCtx.closePath(),this.drawingCanvas.removeEventListener("pointermove",y)),r&&(r=!1,this.drawingCanvas.style.cursor="grab",this.drawingCanvas.removeEventListener("pointermove",d)),this.setIsDrawFalse(100),this.gui_states.segmentation&&this.setIsDrawFalse(1e3)}),this.start=()=>{if(this.nrrd_states.readyToUpdate){if(this.drawingCtx.clearRect(0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight),this.drawingCtx.globalAlpha=this.gui_states.globalAlpha,this.Is_Draw)this.drawingLayerOneCtx.lineCap="round",this.drawingLayerOneCtx.globalAlpha=1;else if(this.Is_Shift_Pressed&&!this.gui_states.segmentation&&!this.gui_states.Eraser&&this.nrrd_states.Mouse_Over&&(this.drawingCtx.clearRect(0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight),this.drawingCtx.fillStyle=this.gui_states.brushColor,this.drawingCtx.beginPath(),this.drawingCtx.arc(this.nrrd_states.Mouse_Over_x,this.nrrd_states.Mouse_Over_y,this.gui_states.brushAndEraserSize/2+1,0,Math.PI*2),this.drawingCtx.strokeStyle=this.gui_states.brushColor,this.drawingCtx.stroke()),this.nrrd_states.enableCursorChoose){this.drawingCtx.clearRect(0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight);const p=this.nrrd_states.cursorPageX*this.nrrd_states.sizeFoctor,P=this.nrrd_states.cursorPageY*this.nrrd_states.sizeFoctor;this.drawLine(p,0,p,this.drawingCanvas.height),this.drawLine(0,P,this.drawingCanvas.width,P)}this.drawingCtx.drawImage(this.drawingCanvasLayerOne,0,0)}else this.redrawDisplayCanvas()},document.addEventListener("keydown",p=>{(p.ctrlKey||p.metaKey)&&p.code==="KeyZ"&&this.undoLastPainting()})}undoLastPainting(){this.Is_Draw=!0,this.drawingCanvasLayerOne.width=this.drawingCanvasLayerOne.width,this.mainPreSlice.repaint.call(this.mainPreSlice);const t=this.getCurrentUndo();if(t.length>0){const e=t[0];if(e.undos.length===0)return;if(e.undos.pop(),e.undos.length>0){const r=e.undos[e.undos.length-1];this.drawingLayerOneCtx.drawImage(r,0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight)}this.previousDrawingImage=this.drawingLayerOneCtx.getImageData(0,0,this.drawingCanvasLayerOne.width,this.drawingCanvasLayerOne.height),this.storeAllImages(this.nrrd_states.currentIndex),this.setIsDrawFalse(1e3)}}getCurrentUndo(){return this.undoArray.filter(t=>t.sliceIndex===this.nrrd_states.currentIndex)}configMouseWheel(t){let e=1;return i=>{if(this.Is_Shift_Pressed)return;i.preventDefault();const a=i.detail?i.detail>0:i.wheelDelta<0;this.Is_Draw=!0;const n=(i.clientX-this.mainAreaContainer.offsetLeft-this.drawingCanvas.offsetLeft)/this.drawingCanvas.offsetWidth,o=(i.clientY-this.mainAreaContainer.offsetTop-this.drawingCanvas.offsetTop)/this.drawingCanvas.offsetHeight,c=a?1-.1:1+.1,d=this.drawingCanvas.offsetWidth*c,h=this.drawingCanvas.offsetHeight*c,u=Math.round(i.clientX-this.mainAreaContainer.offsetLeft-d*n),y=Math.round(i.clientY-this.mainAreaContainer.offsetTop-h*o);e=d/this.nrrd_states.originWidth,e>8?e=8:e<1?e=1:(this.resizePaintArea(e),this.resetPaintArea(u,y),t&&(t.enabled=!1),this.setIsDrawFalse(1e3)),this.nrrd_states.sizeFoctor=e}}useEraser(){const t=(e,r,i)=>{var a=i-this.nrrd_states.stepClear,n=Math.sqrt(i*i-a*a),o=e-a,c=r-n,d=2*a,h=2*n;this.nrrd_states.stepClear<=i&&(this.drawingLayerOneCtx.clearRect(o,c,d,h),this.nrrd_states.stepClear+=1,t(e,r,i))};return t}clearPaint(){this.Is_Draw=!0,this.drawingCanvasLayerOne.width=this.drawingCanvas.width,this.originCanvas.width=this.originCanvas.width,this.mainPreSlice.repaint.call(this.mainPreSlice),this.previousDrawingImage=this.emptyCtx.createImageData(1,1),this.storeAllImages(this.nrrd_states.currentIndex),this.setIsDrawFalse(1e3)}clearStoreImages(){this.paintImages.x.length=0,this.paintImages.y.length=0,this.paintImages.z.length=0,this.initPaintImages(this.nrrd_states.dimensions)}enableDownload(){this.downloadImage.download=`slice_${this.axis}_#${this.nrrd_states.currentIndex}`;const t=this.downloadCanvas.getContext("2d");this.downloadCanvas.width=this.nrrd_states.originWidth,this.downloadCanvas.height=this.nrrd_states.originHeight,t.drawImage(this.drawingCanvas,0,0,this.nrrd_states.originWidth,this.nrrd_states.originHeight),this.downloadImage.href=this.downloadCanvas.toDataURL(),this.downloadImage.click()}paintOnCanvasLayerOne(t,e){this.drawingLayerOneCtx.beginPath(),this.drawingLayerOneCtx.moveTo(this.nrrd_states.drawStartPos.x,this.nrrd_states.drawStartPos.y),this.gui_states.segmentation?(this.drawingLayerOneCtx.strokeStyle=this.gui_states.color,this.drawingLayerOneCtx.lineWidth=this.gui_states.lineWidth):(this.drawingLayerOneCtx.strokeStyle=this.gui_states.brushColor,this.drawingLayerOneCtx.lineWidth=this.gui_states.brushAndEraserSize),this.drawingLayerOneCtx.lineTo(t,e),this.drawingLayerOneCtx.stroke(),this.nrrd_states.drawStartPos.set(t,e),this.drawingLayerOneCtx.closePath(),this.mainPreSlice.mesh.material.map.needsUpdate=!0}configGui(t){t.__controllers.length>0&&this.removeGuiFolderChilden(t),t.open();const e=t.addFolder("Default Actions");e.add(this.gui_states,"cursor",["crosshair","pencil","dot"]).name("cursor icons").onChange(o=>{o==="crosshair"&&(this.nrrd_states.defaultPaintCursor="crosshair"),o==="pencil"&&(this.nrrd_states.defaultPaintCursor="url(https://raw.githubusercontent.com/LinkunGao/copper3d_icons/main/icons/pencil-black.svg), auto"),o==="dot"&&(this.nrrd_states.defaultPaintCursor="url(https://raw.githubusercontent.com/LinkunGao/copper3d-datasets/main/icons/dot.svg) 12 12,auto"),this.drawingCanvas.style.cursor=this.nrrd_states.defaultPaintCursor}),e.add(this.gui_states,"mainAreaSize").name("zoom").min(1).max(8).onFinishChange(o=>{this.resetPaintArea(),this.nrrd_states.sizeFoctor=o,this.resizePaintArea(o)}),e.add(this.gui_states,"resetZoom"),e.add(this.gui_states,"globalAlpha").name("opacity").min(.1).max(1).step(.01),e.add(this.gui_states,"segmentation").name("Pencil"),e.add(this.gui_states,"brushAndEraserSize").min(5).max(50).step(1),e.add(this.gui_states,"Eraser").onChange(o=>{this.gui_states.Eraser=o,this.gui_states.Eraser?this.drawingCanvas.style.cursor=Rt(this.gui_states.brushAndEraserSize):this.drawingCanvas.style.cursor=this.nrrd_states.defaultPaintCursor}),e.add(this.gui_states,"clear"),e.add(this.gui_states,"clearAll"),e.add(this.gui_states,"undo"),e.add(this.mainPreSlice.volume,"windowHigh",this.mainPreSlice.volume.min,this.mainPreSlice.volume.max,1).name("Image contrast").onChange(o=>{this.nrrd_states.readyToUpdate=!1,this.updateSlicesContrast(o,"windowHigh")}).onFinishChange(()=>{this.repraintAllContrastSlices(),this.nrrd_states.readyToUpdate=!0}),e.add(this.gui_states,"exportMarks");const r=t.addFolder("Advance settings");r.add(this.gui_states,"dragSensitivity").min(1).max(this.nrrd_states.Max_sensitive).step(1);const i=r.addFolder("Pencil settings");i.add(this.gui_states,"lineWidth").name("outerLineWidth").min(1.7).max(3).step(.01),i.addColor(this.gui_states,"color"),i.addColor(this.gui_states,"fillColor"),r.addFolder("Brush settings").addColor(this.gui_states,"brushColor"),r.add(this.gui_states,"downloadCurrentMask");const n=r.addFolder("contrast advance settings");n.add(this.mainPreSlice.volume,"lowerThreshold",this.mainPreSlice.volume.min,this.mainPreSlice.volume.max,1).name("Lower Threshold").onChange(o=>{this.nrrd_states.readyToUpdate=!1,this.updateSlicesContrast(o,"lowerThreshold")}).onFinishChange(()=>{this.repraintAllContrastSlices(),this.nrrd_states.readyToUpdate=!0}),n.add(this.mainPreSlice.volume,"upperThreshold",this.mainPreSlice.volume.min,this.mainPreSlice.volume.max,1).name("Upper Threshold").onChange(o=>{this.nrrd_states.readyToUpdate=!1,this.updateSlicesContrast(o,"upperThreshold")}).onFinishChange(()=>{this.repraintAllContrastSlices(),this.nrrd_states.readyToUpdate=!0}),n.add(this.mainPreSlice.volume,"windowLow",this.mainPreSlice.volume.min,this.mainPreSlice.volume.max,1).name("Window Low").onChange(o=>{this.nrrd_states.readyToUpdate=!1,this.updateSlicesContrast(o,"windowLow")}).onFinishChange(()=>{this.repraintAllContrastSlices(),this.nrrd_states.readyToUpdate=!0}),e.open()}updateSlicesContrast(t,e){switch(e){case"lowerThreshold":this.displaySlices.forEach((r,i)=>{r.volume.lowerThreshold=t});break;case"upperThreshold":this.displaySlices.forEach((r,i)=>{r.volume.upperThreshold=t});break;case"windowLow":this.displaySlices.forEach((r,i)=>{r.volume.windowLow=t});break;case"windowHigh":this.displaySlices.forEach((r,i)=>{r.volume.windowHigh=t});break}this.repraintCurrentContrastSlice()}resetPaintArea(t,e){t&&e?(this.displayCanvas.style.left=this.drawingCanvas.style.left=t+"px",this.displayCanvas.style.top=this.drawingCanvas.style.top=e+"px"):(this.displayCanvas.style.left=this.drawingCanvas.style.left="",this.displayCanvas.style.top=this.drawingCanvas.style.top="",this.mainAreaContainer.style.justifyContent="center",this.mainAreaContainer.style.alignItems="center")}redrawDisplayCanvas(){var t,e,r;this.updateCurrentContrastSlice(),this.displayCanvas.width=this.displayCanvas.width,this.displayCanvas.height=this.displayCanvas.height,this.originCanvas.width=this.originCanvas.width,this.currentShowingSlice&&(this.currentShowingSlice.repaint.call(this.currentShowingSlice),(t=this.displayCtx)==null||t.save(),this.flipDisplayImageByAxis(),(e=this.displayCtx)==null||e.drawImage(this.currentShowingSlice.canvas,0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight),(r=this.displayCtx)==null||r.restore())}redrawMianPreOnDisplayCanvas(){var t;this.displayCanvas.width=this.displayCanvas.width,this.displayCanvas.height=this.displayCanvas.height,this.originCanvas.width=this.originCanvas.width,this.mainPreSlice&&(this.mainPreSlice.repaint.call(this.mainPreSlice),this.flipDisplayImageByAxis(),(t=this.displayCtx)==null||t.drawImage(this.originCanvas,0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight),this.resizePaintArea(this.nrrd_states.sizeFoctor))}resizePaintArea(t){var e,r;switch(this.originCanvas.width=this.originCanvas.width,this.displayCanvas.width=this.displayCanvas.width,this.drawingCanvas.width=this.drawingCanvas.width,this.drawingCanvasLayerOne.width=this.drawingCanvasLayerOne.width,this.nrrd_states.changedWidth=this.nrrd_states.originWidth*t,this.nrrd_states.changedHeight=this.nrrd_states.originHeight*t,this.displayCanvas.width=this.nrrd_states.changedWidth,this.displayCanvas.height=this.nrrd_states.changedHeight,this.drawingCanvas.width=this.nrrd_states.changedWidth,this.drawingCanvas.height=this.nrrd_states.changedHeight,this.drawingCanvasLayerOne.width=this.nrrd_states.changedWidth,this.drawingCanvasLayerOne.height=this.nrrd_states.changedHeight,this.redrawDisplayCanvas(),this.axis){case"x":this.paintImages.x.length>0?this.paintedImage=this.filterDrawedImage("x",this.nrrd_states.currentIndex):this.paintedImage=void 0;break;case"y":this.paintImages.y.length>0?this.paintedImage=this.filterDrawedImage("y",this.nrrd_states.currentIndex):this.paintedImage=void 0;break;case"z":this.paintImages.z.length>0?this.paintedImage=this.filterDrawedImage("z",this.nrrd_states.currentIndex):this.paintedImage=void 0;break}(e=this.paintedImage)!=null&&e.image&&(this.setEmptyCanvasSize(),this.emptyCtx.putImageData(this.paintedImage.image,0,0),(r=this.drawingLayerOneCtx)==null||r.drawImage(this.emptyCanvas,0,0,this.nrrd_states.changedWidth,this.nrrd_states.changedHeight))}flipDisplayImageByAxis(){var t,e,r,i;this.axis==="x"?((t=this.displayCtx)==null||t.scale(-1,-1),(e=this.displayCtx)==null||e.translate(-this.nrrd_states.changedWidth,-this.nrrd_states.changedHeight)):this.axis==="z"&&((r=this.displayCtx)==null||r.scale(1,-1),(i=this.displayCtx)==null||i.translate(0,-this.nrrd_states.changedHeight))}filterDrawedImage(t,e){return this.paintImages[t].filter(r=>r.index===e)[0]}removeGuiFolderChilden(t){const e=t.__controllers;e.length>0&&e.forEach(r=>{setTimeout(()=>{t.remove(r)},100)})}verifyCanvasIsEmpty(t){return this.emptyCanvas.width=t.width,this.emptyCanvas.height=t.height,t.toDataURL()===this.emptyCanvas.toDataURL()}clearDictionary(t){for(var e in t)delete t[e]}storeAllImages(t){var a,n,o;this.nrrd_states.loadMaskJson||(this.setEmptyCanvasSize(),this.emptyCtx.drawImage(this.drawingCanvasLayerOne,0,0,this.emptyCanvas.width,this.emptyCanvas.height));let e=this.emptyCtx.getImageData(0,0,this.emptyCanvas.width,this.emptyCanvas.height);switch(this.axis){case"x":const c=this.checkSharedPlaceSlice(this.nrrd_states.nrrd_x_centimeter,this.nrrd_states.nrrd_y_centimeter,e),d=this.sliceArrayV(c,this.nrrd_states.nrrd_y_centimeter,this.nrrd_states.nrrd_z_centimeter),h=this.sliceArrayH(c,this.nrrd_states.nrrd_y_centimeter,this.nrrd_states.nrrd_z_centimeter),u=t;this.replaceVerticalColPixels(this.paintImages.z,this.nrrd_states.dimensions[2],this.nrrd_states.ratios.z,d,this.nrrd_states.nrrd_x_centimeter,u),this.replaceVerticalColPixels(this.paintImages.y,this.nrrd_states.dimensions[1],this.nrrd_states.ratios.y,h,this.nrrd_states.nrrd_x_centimeter,u);break;case"y":const y=this.checkSharedPlaceSlice(this.nrrd_states.nrrd_x_centimeter,this.nrrd_states.nrrd_y_centimeter,e),m=this.sliceArrayV(y,this.nrrd_states.nrrd_z_centimeter,this.nrrd_states.nrrd_x_centimeter),f=this.sliceArrayH(y,this.nrrd_states.nrrd_z_centimeter,this.nrrd_states.nrrd_x_centimeter),g=t;this.replaceHorizontalRowPixels(this.paintImages.x,this.nrrd_states.dimensions[0],this.nrrd_states.ratios.x,m,this.nrrd_states.nrrd_z_centimeter,g),this.replaceHorizontalRowPixels(this.paintImages.z,this.nrrd_states.dimensions[2],this.nrrd_states.ratios.z,f,this.nrrd_states.nrrd_x_centimeter,g);break;case"z":const S=this.checkSharedPlaceSlice(this.nrrd_states.nrrd_x_centimeter,this.nrrd_states.nrrd_y_centimeter,e),_=this.sliceArrayV(S,this.nrrd_states.nrrd_y_centimeter,this.nrrd_states.nrrd_x_centimeter),p=this.sliceArrayH(S,this.nrrd_states.nrrd_y_centimeter,this.nrrd_states.nrrd_x_centimeter),P=t;this.replaceVerticalColPixels(this.paintImages.x,this.nrrd_states.dimensions[0],this.nrrd_states.ratios.x,_,this.nrrd_states.nrrd_z_centimeter,P),this.replaceHorizontalRowPixels(this.paintImages.y,this.nrrd_states.dimensions[1],this.nrrd_states.ratios.y,p,this.nrrd_states.nrrd_x_centimeter,P);break}let r={index:t,image:e},i;switch(this.axis){case"x":i=this.filterDrawedImage("x",t),i?i.image=e:(a=this.paintImages.x)==null||a.push(r);break;case"y":i=this.filterDrawedImage("y",t),i?i.image=e:(n=this.paintImages.y)==null||n.push(r);break;case"z":i=this.filterDrawedImage("z",t),i?i.image=e:(o=this.paintImages.z)==null||o.push(r);break}this.nrrd_states.loadMaskJson||this.nrrd_states.getMasks(this.paintImages.z,this.paintImages.z.length,this.nrrd_states.nrrd_x_centimeter,this.nrrd_states.nrrd_y_centimeter)}sliceArrayH(t,e,r){const i=[];for(let a=0;a<e;a++){const n=a*r*4,o=(a+1)*r*4,c=t.slice(n,o);i.push(c)}return i}sliceArrayV(t,e,r){const i=[],a=r*4;for(let n=0;n<r;n++){const o=[];for(let c=0;c<e;c++){const d=a*c+n*4;o.push(t[d]),o.push(t[d+1]),o.push(t[d+2]),o.push(t[d+3])}i.push(o)}return i}replaceVerticalColPixels(t,e,r,i,a,n){for(let o=0,c=e;o<c;o++){const d=Math.floor(o*r),h=t[o].image.data,u=i[d],y=a*4;for(let m=0,f=u.length;m<f;m+=4){const g=m/4*y+n*4;h[g]=u[m],h[g+1]=u[m+1],h[g+2]=u[m+2],h[g+3]=u[m+3]}}}replaceHorizontalRowPixels(t,e,r,i,a,n){for(let o=0,c=e;o<c;o++){const d=Math.floor(o*r),h=t[o].image.data,u=i[d],y=a*n*4;for(let m=0,f=u.length;m<f;m++)h[y+m]=u[m]}}setEmptyCanvasSize(){switch(this.axis){case"x":this.emptyCanvas.width=this.nrrd_states.nrrd_z_centimeter,this.emptyCanvas.height=this.nrrd_states.nrrd_y_centimeter;break;case"y":this.emptyCanvas.width=this.nrrd_states.nrrd_x_centimeter,this.emptyCanvas.height=this.nrrd_states.nrrd_z_centimeter;break;case"z":this.emptyCanvas.width=this.nrrd_states.nrrd_x_centimeter,this.emptyCanvas.height=this.nrrd_states.nrrd_y_centimeter;break}}checkSharedPlaceSlice(t,e,r){let i=this.emptyCtx.createImageData(t,e).data;if(this.nrrd_states.sharedPlace.z.includes(this.nrrd_states.currentIndex)){const a=this.findSliceInSharedPlace();if(a.push(r),a.length>0)for(let n=0;n<a.length;n++)this.replaceArray(i,a[n].data)}else i=r.data;return i}replaceArray(t,e){for(let r=0,i=e.length;r<i;r++)e[r]===0||t[r]!==0||(t[r]=e[r])}findSliceInSharedPlace(){const t=[],e=Math.floor(this.nrrd_states.currentIndex*this.nrrd_states.ratios[this.axis]);for(let r=1;r<=3;r++){const i=this.nrrd_states.currentIndex-r;if(i<this.nrrd_states.minIndex)break;Math.floor(i*this.nrrd_states.ratios[this.axis])===e&&t.push(this.paintImages[this.axis][i].image)}for(let r=1;r<=3;r++){const i=this.nrrd_states.currentIndex+r;if(i>this.nrrd_states.maxIndex)break;Math.floor(i*this.nrrd_states.ratios[this.axis])===e&&t.push(this.paintImages[this.axis][i].image)}return t}exportData(){let t={x:[],y:[],z:[]};t.z=this.restructData(this.paintImages.z,this.paintImages.z.length,this.nrrd_states.nrrd_x_centimeter,this.nrrd_states.nrrd_y_centimeter),window.alert("Export all images, starting!!!");try{for(let e=0;e<3;e++)switch(e){case 0:if(t.x.length>0){const r=new Blob([JSON.stringify(t.x)],{type:"text/plain;charset=utf-8"});ht(r,"copper3D_export data_x.json")}break;case 1:if(t.y.length>0){const r=new Blob([JSON.stringify(t.y)],{type:"text/plain;charset=utf-8"});ht(r,"copper3D_export data_y.json")}break;case 2:if(t.z.length>0){const r=new Blob([JSON.stringify(t.z)],{type:"text/plain;charset=utf-8"});ht(r,"copper3D_export data_z.json")}break}window.alert("Export all images successfully!!!")}catch(e){console.log(e),window.alert("Export failed!")}}restructData(t,e,r,i){const a=[];for(let n=0;n<e;n++){let o={sliceIndex:0,dataFormat:"RGBA - Each successive 4-digit number forms a pixel point in data array",width:r,height:i,voxelSpacing:this.nrrd_states.voxelSpacing,spaceOrigin:this.nrrd_states.spaceOrigin,data:[]};o.sliceIndex=t[n].index;const c=t[n].image,d=[];for(let h=0;h<c.data.length;h++)d.push(c.data[h]);o.data=d,a.push(o)}return a}}const Y=s=>(Yt("data-v-4ab276ea"),s=s(),$t(),s),We={class:"nav"},je={class:"content"},Ve={class:"arrows"},Xe=Y(()=>I("ion-icon",{name:"add-circle-outline"},null,-1)),Ye=[Xe],$e=Y(()=>I("ion-icon",{name:"remove-circle-outline"},null,-1)),qe=[$e],Je=Y(()=>I("ion-icon",{name:"chevron-back-circle-outline"},null,-1)),Ge=[Je],Ke=Y(()=>I("ion-icon",{name:"chevron-down-circle-outline"},null,-1)),Ze=[Ke],Qe=Y(()=>I("ion-icon",{name:"chevron-forward-circle-outline"},null,-1)),ts=[Qe],es=Y(()=>I("ion-icon",{name:"cloud-upload-outline"},null,-1)),ss=[es],rs=Ct({__name:"NavBar",props:{fileNum:{default:0},min:{default:0},max:{default:160},initSliceIndex:null,immediateSliceNum:{default:0},contrastIndex:{default:0},isAxisClicked:{type:Boolean,default:!1}},emits:["onSliceChange","resetMainAreaSize","onChangeOrientation","onOpenDialog"],setup(s,{emit:t}){const e=s,r=ze(e),{immediateSliceNum:i,contrastIndex:a,initSliceIndex:n,fileNum:o}=Te(r),c=L(0);let d=0,h=!1,u=!1;const y=()=>{t("onOpenDialog",!0)},m=_=>{h=!0,t("onChangeOrientation",_),h=!1},f=_=>{t("resetMainAreaSize",_)},g=()=>{const _=c.value-d;d+=_,!h&&!u&&t("onSliceChange",_),h=!1,u=!1};document.addEventListener("keydown",_=>{_.key==="ArrowUp"&&d>0&&(d-=1,S(),t("onSliceChange",-1)),_.key==="ArrowDown"&&d<e.max&&(d+=1,S(),t("onSliceChange",1))});const S=()=>{c.value=d};return mt(()=>{d=i.value*o.value+a.value,S()}),mt(()=>{n!=null&&n.value&&(d=(n==null?void 0:n.value)*o.value),S()}),(_,p)=>{const P=gt("el-slider");return St(),vt("div",We,[I("div",je,[V(P,{modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=E=>c.value=E),max:U(e).max,onInput:g,"show-input":""},null,8,["modelValue","max"]),I("div",Ve,[I("span",{onClick:p[1]||(p[1]=E=>f(.5))},Ye),I("span",{onClick:p[2]||(p[2]=E=>f(-.5))},qe),I("span",{onClick:p[3]||(p[3]=E=>m("x"))},Ge),I("span",{onClick:p[4]||(p[4]=E=>m("z"))},Ze),I("span",{onClick:p[5]||(p[5]=E=>m("y"))},ts),I("span",{onClick:y},ss)])])])}}});const is=qt(rs,[["__scopeId","data-v-4ab276ea"]]),Jt=s=>(Yt("data-v-82614724"),s=s(),$t(),s),ns=Jt(()=>I("div",{class:"el-upload__text"},[Ue(" Drop file here or "),I("em",null,"click to upload")],-1)),as=Jt(()=>I("div",{class:"el-upload__tip"},"Please drag or upload NRRD files!",-1)),os=Ct({__name:"Upload",props:{dialog:{type:Boolean,default:!1}},emits:["onCloseDialog","getLoadFilesUrls"],setup(s,{emit:t}){let e=[],r=[],i=!1;const a=h=>{let u=h.currentTarget,y=h.target;u===y&&(e.forEach(m=>{const f=URL.createObjectURL(m);r.push(f)}),t("getLoadFilesUrls",r),t("onCloseDialog",!1),i=!0,n())},n=()=>{e=[],r.forEach(h=>{URL.revokeObjectURL(h)}),r=[]},o=h=>{i&&(i=!1,n());let u=h.name,y;u.match(/\.(nrrd)$/)&&(y=h.raw,e.push(y)),y||d("No .nrrd asset found!")},c=h=>{e=e.filter(u=>u.name!==h.name),console.log(e)},d=h=>{let u=(h||{}).message||h.toString();u.match(/ProgressEvent/)?u="Unable to retrieve this file. Check JS console and browser network tab.":u.match(/Unexpected token/)?u=`Unable to parse file content. Verify that this file is valid. Error: "${u}"`:h&&h.target&&h.target instanceof Image&&(u="Missing texture: "+h.target.src.split("/").pop()),window.alert(u),console.error(h)};return(h,u)=>{const y=gt("el-icon"),m=gt("el-upload");return s.dialog?(St(),vt("div",{key:0,onClick:a,class:"upload_container"},[V(m,{"auto-upload":!1,onChange:o,onRemove:c,class:"upload-demo",drag:"",action:"/",multiple:""},{tip:lt(()=>[as]),default:lt(()=>[V(y,{class:"el-icon--upload"},{default:lt(()=>[V(U(Fe))]),_:1}),ns]),_:1})])):Me("",!0)}}});const ds=qt(os,[["__scopeId","data-v-82614724"]]);function Gt(s,t){return function(){return s.apply(t,arguments)}}const{toString:Kt}=Object.prototype,{getPrototypeOf:Pt}=Object,It=(s=>t=>{const e=Kt.call(t);return s[e]||(s[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),T=s=>(s=s.toLowerCase(),t=>It(t)===s),it=s=>t=>typeof t===s,{isArray:$}=Array,G=it("undefined");function ls(s){return s!==null&&!G(s)&&s.constructor!==null&&!G(s.constructor)&&H(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Zt=T("ArrayBuffer");function hs(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&Zt(s.buffer),t}const cs=it("string"),H=it("function"),Qt=it("number"),bt=s=>s!==null&&typeof s=="object",us=s=>s===!0||s===!1,Q=s=>{if(It(s)!=="object")return!1;const t=Pt(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},fs=T("Date"),ps=T("File"),ms=T("Blob"),gs=T("FileList"),_s=s=>bt(s)&&H(s.pipe),ys=s=>{const t="[object FormData]";return s&&(typeof FormData=="function"&&s instanceof FormData||Kt.call(s)===t||H(s.toString)&&s.toString()===t)},ws=T("URLSearchParams"),xs=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function K(s,t,{allOwnKeys:e=!1}={}){if(s===null||typeof s>"u")return;let r,i;if(typeof s!="object"&&(s=[s]),$(s))for(r=0,i=s.length;r<i;r++)t.call(null,s[r],r,s);else{const a=e?Object.getOwnPropertyNames(s):Object.keys(s),n=a.length;let o;for(r=0;r<n;r++)o=a[r],t.call(null,s[o],o,s)}}function te(s,t){t=t.toLowerCase();const e=Object.keys(s);let r=e.length,i;for(;r-- >0;)if(i=e[r],t===i.toLowerCase())return i;return null}const ee=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),se=s=>!G(s)&&s!==ee;function _t(){const{caseless:s}=se(this)&&this||{},t={},e=(r,i)=>{const a=s&&te(t,i)||i;Q(t[a])&&Q(r)?t[a]=_t(t[a],r):Q(r)?t[a]=_t({},r):$(r)?t[a]=r.slice():t[a]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&K(arguments[r],e);return t}const Cs=(s,t,e,{allOwnKeys:r}={})=>(K(t,(i,a)=>{e&&H(i)?s[a]=Gt(i,e):s[a]=i},{allOwnKeys:r}),s),vs=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),Ss=(s,t,e,r)=>{s.prototype=Object.create(t.prototype,r),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),e&&Object.assign(s.prototype,e)},Ps=(s,t,e,r)=>{let i,a,n;const o={};if(t=t||{},s==null)return t;do{for(i=Object.getOwnPropertyNames(s),a=i.length;a-- >0;)n=i[a],(!r||r(n,s,t))&&!o[n]&&(t[n]=s[n],o[n]=!0);s=e!==!1&&Pt(s)}while(s&&(!e||e(s,t))&&s!==Object.prototype);return t},Is=(s,t,e)=>{s=String(s),(e===void 0||e>s.length)&&(e=s.length),e-=t.length;const r=s.indexOf(t,e);return r!==-1&&r===e},bs=s=>{if(!s)return null;if($(s))return s;let t=s.length;if(!Qt(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=s[t];return e},Es=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&Pt(Uint8Array)),As=(s,t)=>{const r=(s&&s[Symbol.iterator]).call(s);let i;for(;(i=r.next())&&!i.done;){const a=i.value;t.call(s,a[0],a[1])}},Os=(s,t)=>{let e;const r=[];for(;(e=s.exec(t))!==null;)r.push(e);return r},Ds=T("HTMLFormElement"),Ls=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,r,i){return r.toUpperCase()+i}),Tt=(({hasOwnProperty:s})=>(t,e)=>s.call(t,e))(Object.prototype),ks=T("RegExp"),re=(s,t)=>{const e=Object.getOwnPropertyDescriptors(s),r={};K(e,(i,a)=>{t(i,a,s)!==!1&&(r[a]=i)}),Object.defineProperties(s,r)},Ns=s=>{re(s,(t,e)=>{if(H(s)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const r=s[e];if(!!H(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},Rs=(s,t)=>{const e={},r=i=>{i.forEach(a=>{e[a]=!0})};return $(s)?r(s):r(String(s).split(t)),e},zs=()=>{},Ts=(s,t)=>(s=+s,Number.isFinite(s)?s:t),ct="abcdefghijklmnopqrstuvwxyz",Mt="0123456789",ie={DIGIT:Mt,ALPHA:ct,ALPHA_DIGIT:ct+ct.toUpperCase()+Mt},Ms=(s=16,t=ie.ALPHA_DIGIT)=>{let e="";const{length:r}=t;for(;s--;)e+=t[Math.random()*r|0];return e};function Fs(s){return!!(s&&H(s.append)&&s[Symbol.toStringTag]==="FormData"&&s[Symbol.iterator])}const Us=s=>{const t=new Array(10),e=(r,i)=>{if(bt(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const a=$(r)?[]:{};return K(r,(n,o)=>{const c=e(n,i+1);!G(c)&&(a[o]=c)}),t[i]=void 0,a}}return r};return e(s,0)},l={isArray:$,isArrayBuffer:Zt,isBuffer:ls,isFormData:ys,isArrayBufferView:hs,isString:cs,isNumber:Qt,isBoolean:us,isObject:bt,isPlainObject:Q,isUndefined:G,isDate:fs,isFile:ps,isBlob:ms,isRegExp:ks,isFunction:H,isStream:_s,isURLSearchParams:ws,isTypedArray:Es,isFileList:gs,forEach:K,merge:_t,extend:Cs,trim:xs,stripBOM:vs,inherits:Ss,toFlatObject:Ps,kindOf:It,kindOfTest:T,endsWith:Is,toArray:bs,forEachEntry:As,matchAll:Os,isHTMLForm:Ds,hasOwnProperty:Tt,hasOwnProp:Tt,reduceDescriptors:re,freezeMethods:Ns,toObjectSet:Rs,toCamelCase:Ls,noop:zs,toFiniteNumber:Ts,findKey:te,global:ee,isContextDefined:se,ALPHABET:ie,generateString:Ms,isSpecCompliantForm:Fs,toJSONObject:Us};function x(s,t,e,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),r&&(this.request=r),i&&(this.response=i)}l.inherits(x,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:l.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ne=x.prototype,ae={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{ae[s]={value:s}});Object.defineProperties(x,ae);Object.defineProperty(ne,"isAxiosError",{value:!0});x.from=(s,t,e,r,i,a)=>{const n=Object.create(ne);return l.toFlatObject(s,n,function(c){return c!==Error.prototype},o=>o!=="isAxiosError"),x.call(n,s.message,t,e,r,i),n.cause=s,n.name=s.name,a&&Object.assign(n,a),n};const Hs=null;function yt(s){return l.isPlainObject(s)||l.isArray(s)}function oe(s){return l.endsWith(s,"[]")?s.slice(0,-2):s}function Ft(s,t,e){return s?s.concat(t).map(function(i,a){return i=oe(i),!e&&a?"["+i+"]":i}).join(e?".":""):t}function Bs(s){return l.isArray(s)&&!s.some(yt)}const Ws=l.toFlatObject(l,{},null,function(t){return/^is[A-Z]/.test(t)});function nt(s,t,e){if(!l.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,e=l.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,S){return!l.isUndefined(S[g])});const r=e.metaTokens,i=e.visitor||h,a=e.dots,n=e.indexes,c=(e.Blob||typeof Blob<"u"&&Blob)&&l.isSpecCompliantForm(t);if(!l.isFunction(i))throw new TypeError("visitor must be a function");function d(f){if(f===null)return"";if(l.isDate(f))return f.toISOString();if(!c&&l.isBlob(f))throw new x("Blob is not supported. Use a Buffer instead.");return l.isArrayBuffer(f)||l.isTypedArray(f)?c&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function h(f,g,S){let _=f;if(f&&!S&&typeof f=="object"){if(l.endsWith(g,"{}"))g=r?g:g.slice(0,-2),f=JSON.stringify(f);else if(l.isArray(f)&&Bs(f)||(l.isFileList(f)||l.endsWith(g,"[]"))&&(_=l.toArray(f)))return g=oe(g),_.forEach(function(P,E){!(l.isUndefined(P)||P===null)&&t.append(n===!0?Ft([g],E,a):n===null?g:g+"[]",d(P))}),!1}return yt(f)?!0:(t.append(Ft(S,g,a),d(f)),!1)}const u=[],y=Object.assign(Ws,{defaultVisitor:h,convertValue:d,isVisitable:yt});function m(f,g){if(!l.isUndefined(f)){if(u.indexOf(f)!==-1)throw Error("Circular reference detected in "+g.join("."));u.push(f),l.forEach(f,function(_,p){(!(l.isUndefined(_)||_===null)&&i.call(t,_,l.isString(p)?p.trim():p,g,y))===!0&&m(_,g?g.concat(p):[p])}),u.pop()}}if(!l.isObject(s))throw new TypeError("data must be an object");return m(s),t}function Ut(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function Et(s,t){this._pairs=[],s&&nt(s,this,t)}const de=Et.prototype;de.append=function(t,e){this._pairs.push([t,e])};de.toString=function(t){const e=t?function(r){return t.call(this,r,Ut)}:Ut;return this._pairs.map(function(i){return e(i[0])+"="+e(i[1])},"").join("&")};function js(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function le(s,t,e){if(!t)return s;const r=e&&e.encode||js,i=e&&e.serialize;let a;if(i?a=i(t,e):a=l.isURLSearchParams(t)?t.toString():new Et(t,e).toString(r),a){const n=s.indexOf("#");n!==-1&&(s=s.slice(0,n)),s+=(s.indexOf("?")===-1?"?":"&")+a}return s}class Vs{constructor(){this.handlers=[]}use(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){l.forEach(this.handlers,function(r){r!==null&&t(r)})}}const Ht=Vs,he={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Xs=typeof URLSearchParams<"u"?URLSearchParams:Et,Ys=typeof FormData<"u"?FormData:null,$s=(()=>{let s;return typeof navigator<"u"&&((s=navigator.product)==="ReactNative"||s==="NativeScript"||s==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),qs=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),R={isBrowser:!0,classes:{URLSearchParams:Xs,FormData:Ys,Blob},isStandardBrowserEnv:$s,isStandardBrowserWebWorkerEnv:qs,protocols:["http","https","file","blob","url","data"]};function Js(s,t){return nt(s,new R.classes.URLSearchParams,Object.assign({visitor:function(e,r,i,a){return R.isNode&&l.isBuffer(e)?(this.append(r,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},t))}function Gs(s){return l.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function Ks(s){const t={},e=Object.keys(s);let r;const i=e.length;let a;for(r=0;r<i;r++)a=e[r],t[a]=s[a];return t}function ce(s){function t(e,r,i,a){let n=e[a++];const o=Number.isFinite(+n),c=a>=e.length;return n=!n&&l.isArray(i)?i.length:n,c?(l.hasOwnProp(i,n)?i[n]=[i[n],r]:i[n]=r,!o):((!i[n]||!l.isObject(i[n]))&&(i[n]=[]),t(e,r,i[n],a)&&l.isArray(i[n])&&(i[n]=Ks(i[n])),!o)}if(l.isFormData(s)&&l.isFunction(s.entries)){const e={};return l.forEachEntry(s,(r,i)=>{t(Gs(r),i,e,0)}),e}return null}const Zs={"Content-Type":void 0};function Qs(s,t,e){if(l.isString(s))try{return(t||JSON.parse)(s),l.trim(s)}catch(r){if(r.name!=="SyntaxError")throw r}return(e||JSON.stringify)(s)}const at={transitional:he,adapter:["xhr","http"],transformRequest:[function(t,e){const r=e.getContentType()||"",i=r.indexOf("application/json")>-1,a=l.isObject(t);if(a&&l.isHTMLForm(t)&&(t=new FormData(t)),l.isFormData(t))return i&&i?JSON.stringify(ce(t)):t;if(l.isArrayBuffer(t)||l.isBuffer(t)||l.isStream(t)||l.isFile(t)||l.isBlob(t))return t;if(l.isArrayBufferView(t))return t.buffer;if(l.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Js(t,this.formSerializer).toString();if((o=l.isFileList(t))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return nt(o?{"files[]":t}:t,c&&new c,this.formSerializer)}}return a||i?(e.setContentType("application/json",!1),Qs(t)):t}],transformResponse:[function(t){const e=this.transitional||at.transitional,r=e&&e.forcedJSONParsing,i=this.responseType==="json";if(t&&l.isString(t)&&(r&&!this.responseType||i)){const n=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(o){if(n)throw o.name==="SyntaxError"?x.from(o,x.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:R.classes.FormData,Blob:R.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],function(t){at.headers[t]={}});l.forEach(["post","put","patch"],function(t){at.headers[t]=l.merge(Zs)});const At=at,tr=l.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),er=s=>{const t={};let e,r,i;return s&&s.split(`
`).forEach(function(n){i=n.indexOf(":"),e=n.substring(0,i).trim().toLowerCase(),r=n.substring(i+1).trim(),!(!e||t[e]&&tr[e])&&(e==="set-cookie"?t[e]?t[e].push(r):t[e]=[r]:t[e]=t[e]?t[e]+", "+r:r)}),t},Bt=Symbol("internals");function J(s){return s&&String(s).trim().toLowerCase()}function tt(s){return s===!1||s==null?s:l.isArray(s)?s.map(tt):String(s)}function sr(s){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=e.exec(s);)t[r[1]]=r[2];return t}function rr(s){return/^[-_a-zA-Z]+$/.test(s.trim())}function ut(s,t,e,r,i){if(l.isFunction(r))return r.call(this,t,e);if(i&&(t=e),!!l.isString(t)){if(l.isString(r))return t.indexOf(r)!==-1;if(l.isRegExp(r))return r.test(t)}}function ir(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,r)=>e.toUpperCase()+r)}function nr(s,t){const e=l.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(s,r+e,{value:function(i,a,n){return this[r].call(this,t,i,a,n)},configurable:!0})})}class ot{constructor(t){t&&this.set(t)}set(t,e,r){const i=this;function a(o,c,d){const h=J(c);if(!h)throw new Error("header name must be a non-empty string");const u=l.findKey(i,h);(!u||i[u]===void 0||d===!0||d===void 0&&i[u]!==!1)&&(i[u||c]=tt(o))}const n=(o,c)=>l.forEach(o,(d,h)=>a(d,h,c));return l.isPlainObject(t)||t instanceof this.constructor?n(t,e):l.isString(t)&&(t=t.trim())&&!rr(t)?n(er(t),e):t!=null&&a(e,t,r),this}get(t,e){if(t=J(t),t){const r=l.findKey(this,t);if(r){const i=this[r];if(!e)return i;if(e===!0)return sr(i);if(l.isFunction(e))return e.call(this,i,r);if(l.isRegExp(e))return e.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=J(t),t){const r=l.findKey(this,t);return!!(r&&this[r]!==void 0&&(!e||ut(this,this[r],r,e)))}return!1}delete(t,e){const r=this;let i=!1;function a(n){if(n=J(n),n){const o=l.findKey(r,n);o&&(!e||ut(r,r[o],o,e))&&(delete r[o],i=!0)}}return l.isArray(t)?t.forEach(a):a(t),i}clear(t){const e=Object.keys(this);let r=e.length,i=!1;for(;r--;){const a=e[r];(!t||ut(this,this[a],a,t,!0))&&(delete this[a],i=!0)}return i}normalize(t){const e=this,r={};return l.forEach(this,(i,a)=>{const n=l.findKey(r,a);if(n){e[n]=tt(i),delete e[a];return}const o=t?ir(a):String(a).trim();o!==a&&delete e[a],e[o]=tt(i),r[o]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return l.forEach(this,(r,i)=>{r!=null&&r!==!1&&(e[i]=t&&l.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const r=new this(t);return e.forEach(i=>r.set(i)),r}static accessor(t){const r=(this[Bt]=this[Bt]={accessors:{}}).accessors,i=this.prototype;function a(n){const o=J(n);r[o]||(nr(i,n),r[o]=!0)}return l.isArray(t)?t.forEach(a):a(t),this}}ot.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);l.freezeMethods(ot.prototype);l.freezeMethods(ot);const z=ot;function ft(s,t){const e=this||At,r=t||e,i=z.from(r.headers);let a=r.data;return l.forEach(s,function(o){a=o.call(e,a,i.normalize(),t?t.status:void 0)}),i.normalize(),a}function ue(s){return!!(s&&s.__CANCEL__)}function Z(s,t,e){x.call(this,s==null?"canceled":s,x.ERR_CANCELED,t,e),this.name="CanceledError"}l.inherits(Z,x,{__CANCEL__:!0});function ar(s,t,e){const r=e.config.validateStatus;!e.status||!r||r(e.status)?s(e):t(new x("Request failed with status code "+e.status,[x.ERR_BAD_REQUEST,x.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}const or=R.isStandardBrowserEnv?function(){return{write:function(e,r,i,a,n,o){const c=[];c.push(e+"="+encodeURIComponent(r)),l.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),l.isString(a)&&c.push("path="+a),l.isString(n)&&c.push("domain="+n),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function dr(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function lr(s,t){return t?s.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):s}function fe(s,t){return s&&!dr(t)?lr(s,t):t}const hr=R.isStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let r;function i(a){let n=a;return t&&(e.setAttribute("href",n),n=e.href),e.setAttribute("href",n),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return r=i(window.location.href),function(n){const o=l.isString(n)?i(n):n;return o.protocol===r.protocol&&o.host===r.host}}():function(){return function(){return!0}}();function cr(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function ur(s,t){s=s||10;const e=new Array(s),r=new Array(s);let i=0,a=0,n;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),h=r[a];n||(n=d),e[i]=c,r[i]=d;let u=a,y=0;for(;u!==i;)y+=e[u++],u=u%s;if(i=(i+1)%s,i===a&&(a=(a+1)%s),d-n<t)return;const m=h&&d-h;return m?Math.round(y*1e3/m):void 0}}function Wt(s,t){let e=0;const r=ur(50,250);return i=>{const a=i.loaded,n=i.lengthComputable?i.total:void 0,o=a-e,c=r(o),d=a<=n;e=a;const h={loaded:a,total:n,progress:n?a/n:void 0,bytes:o,rate:c||void 0,estimated:c&&n&&d?(n-a)/c:void 0,event:i};h[t?"download":"upload"]=!0,s(h)}}const fr=typeof XMLHttpRequest<"u",pr=fr&&function(s){return new Promise(function(e,r){let i=s.data;const a=z.from(s.headers).normalize(),n=s.responseType;let o;function c(){s.cancelToken&&s.cancelToken.unsubscribe(o),s.signal&&s.signal.removeEventListener("abort",o)}l.isFormData(i)&&(R.isStandardBrowserEnv||R.isStandardBrowserWebWorkerEnv)&&a.setContentType(!1);let d=new XMLHttpRequest;if(s.auth){const m=s.auth.username||"",f=s.auth.password?unescape(encodeURIComponent(s.auth.password)):"";a.set("Authorization","Basic "+btoa(m+":"+f))}const h=fe(s.baseURL,s.url);d.open(s.method.toUpperCase(),le(h,s.params,s.paramsSerializer),!0),d.timeout=s.timeout;function u(){if(!d)return;const m=z.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),g={data:!n||n==="text"||n==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:m,config:s,request:d};ar(function(_){e(_),c()},function(_){r(_),c()},g),d=null}if("onloadend"in d?d.onloadend=u:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(u)},d.onabort=function(){!d||(r(new x("Request aborted",x.ECONNABORTED,s,d)),d=null)},d.onerror=function(){r(new x("Network Error",x.ERR_NETWORK,s,d)),d=null},d.ontimeout=function(){let f=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const g=s.transitional||he;s.timeoutErrorMessage&&(f=s.timeoutErrorMessage),r(new x(f,g.clarifyTimeoutError?x.ETIMEDOUT:x.ECONNABORTED,s,d)),d=null},R.isStandardBrowserEnv){const m=(s.withCredentials||hr(h))&&s.xsrfCookieName&&or.read(s.xsrfCookieName);m&&a.set(s.xsrfHeaderName,m)}i===void 0&&a.setContentType(null),"setRequestHeader"in d&&l.forEach(a.toJSON(),function(f,g){d.setRequestHeader(g,f)}),l.isUndefined(s.withCredentials)||(d.withCredentials=!!s.withCredentials),n&&n!=="json"&&(d.responseType=s.responseType),typeof s.onDownloadProgress=="function"&&d.addEventListener("progress",Wt(s.onDownloadProgress,!0)),typeof s.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",Wt(s.onUploadProgress)),(s.cancelToken||s.signal)&&(o=m=>{!d||(r(!m||m.type?new Z(null,s,d):m),d.abort(),d=null)},s.cancelToken&&s.cancelToken.subscribe(o),s.signal&&(s.signal.aborted?o():s.signal.addEventListener("abort",o)));const y=cr(h);if(y&&R.protocols.indexOf(y)===-1){r(new x("Unsupported protocol "+y+":",x.ERR_BAD_REQUEST,s));return}d.send(i||null)})},et={http:Hs,xhr:pr};l.forEach(et,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const mr={getAdapter:s=>{s=l.isArray(s)?s:[s];const{length:t}=s;let e,r;for(let i=0;i<t&&(e=s[i],!(r=l.isString(e)?et[e.toLowerCase()]:e));i++);if(!r)throw r===!1?new x(`Adapter ${e} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(l.hasOwnProp(et,e)?`Adapter '${e}' is not available in the build`:`Unknown adapter '${e}'`);if(!l.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:et};function pt(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new Z(null,s)}function jt(s){return pt(s),s.headers=z.from(s.headers),s.data=ft.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),mr.getAdapter(s.adapter||At.adapter)(s).then(function(r){return pt(s),r.data=ft.call(s,s.transformResponse,r),r.headers=z.from(r.headers),r},function(r){return ue(r)||(pt(s),r&&r.response&&(r.response.data=ft.call(s,s.transformResponse,r.response),r.response.headers=z.from(r.response.headers))),Promise.reject(r)})}const Vt=s=>s instanceof z?s.toJSON():s;function X(s,t){t=t||{};const e={};function r(d,h,u){return l.isPlainObject(d)&&l.isPlainObject(h)?l.merge.call({caseless:u},d,h):l.isPlainObject(h)?l.merge({},h):l.isArray(h)?h.slice():h}function i(d,h,u){if(l.isUndefined(h)){if(!l.isUndefined(d))return r(void 0,d,u)}else return r(d,h,u)}function a(d,h){if(!l.isUndefined(h))return r(void 0,h)}function n(d,h){if(l.isUndefined(h)){if(!l.isUndefined(d))return r(void 0,d)}else return r(void 0,h)}function o(d,h,u){if(u in t)return r(d,h);if(u in s)return r(void 0,d)}const c={url:a,method:a,data:a,baseURL:n,transformRequest:n,transformResponse:n,paramsSerializer:n,timeout:n,timeoutMessage:n,withCredentials:n,adapter:n,responseType:n,xsrfCookieName:n,xsrfHeaderName:n,onUploadProgress:n,onDownloadProgress:n,decompress:n,maxContentLength:n,maxBodyLength:n,beforeRedirect:n,transport:n,httpAgent:n,httpsAgent:n,cancelToken:n,socketPath:n,responseEncoding:n,validateStatus:o,headers:(d,h)=>i(Vt(d),Vt(h),!0)};return l.forEach(Object.keys(s).concat(Object.keys(t)),function(h){const u=c[h]||i,y=u(s[h],t[h],h);l.isUndefined(y)&&u!==o||(e[h]=y)}),e}const pe="1.3.3",Ot={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{Ot[s]=function(r){return typeof r===s||"a"+(t<1?"n ":" ")+s}});const Xt={};Ot.transitional=function(t,e,r){function i(a,n){return"[Axios v"+pe+"] Transitional option '"+a+"'"+n+(r?". "+r:"")}return(a,n,o)=>{if(t===!1)throw new x(i(n," has been removed"+(e?" in "+e:"")),x.ERR_DEPRECATED);return e&&!Xt[n]&&(Xt[n]=!0,console.warn(i(n," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(a,n,o):!0}};function gr(s,t,e){if(typeof s!="object")throw new x("options must be an object",x.ERR_BAD_OPTION_VALUE);const r=Object.keys(s);let i=r.length;for(;i-- >0;){const a=r[i],n=t[a];if(n){const o=s[a],c=o===void 0||n(o,a,s);if(c!==!0)throw new x("option "+a+" must be "+c,x.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new x("Unknown option "+a,x.ERR_BAD_OPTION)}}const wt={assertOptions:gr,validators:Ot},F=wt.validators;class rt{constructor(t){this.defaults=t,this.interceptors={request:new Ht,response:new Ht}}request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=X(this.defaults,e);const{transitional:r,paramsSerializer:i,headers:a}=e;r!==void 0&&wt.assertOptions(r,{silentJSONParsing:F.transitional(F.boolean),forcedJSONParsing:F.transitional(F.boolean),clarifyTimeoutError:F.transitional(F.boolean)},!1),i!==void 0&&wt.assertOptions(i,{encode:F.function,serialize:F.function},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let n;n=a&&l.merge(a.common,a[e.method]),n&&l.forEach(["delete","get","head","post","put","patch","common"],f=>{delete a[f]}),e.headers=z.concat(n,a);const o=[];let c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(c=c&&g.synchronous,o.unshift(g.fulfilled,g.rejected))});const d=[];this.interceptors.response.forEach(function(g){d.push(g.fulfilled,g.rejected)});let h,u=0,y;if(!c){const f=[jt.bind(this),void 0];for(f.unshift.apply(f,o),f.push.apply(f,d),y=f.length,h=Promise.resolve(e);u<y;)h=h.then(f[u++],f[u++]);return h}y=o.length;let m=e;for(u=0;u<y;){const f=o[u++],g=o[u++];try{m=f(m)}catch(S){g.call(this,S);break}}try{h=jt.call(this,m)}catch(f){return Promise.reject(f)}for(u=0,y=d.length;u<y;)h=h.then(d[u++],d[u++]);return h}getUri(t){t=X(this.defaults,t);const e=fe(t.baseURL,t.url);return le(e,t.params,t.paramsSerializer)}}l.forEach(["delete","get","head","options"],function(t){rt.prototype[t]=function(e,r){return this.request(X(r||{},{method:t,url:e,data:(r||{}).data}))}});l.forEach(["post","put","patch"],function(t){function e(r){return function(a,n,o){return this.request(X(o||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:n}))}}rt.prototype[t]=e(),rt.prototype[t+"Form"]=e(!0)});const st=rt;class Dt{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(a){e=a});const r=this;this.promise.then(i=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](i);r._listeners=null}),this.promise.then=i=>{let a;const n=new Promise(o=>{r.subscribe(o),a=o}).then(i);return n.cancel=function(){r.unsubscribe(a)},n},t(function(a,n,o){r.reason||(r.reason=new Z(a,n,o),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}static source(){let t;return{token:new Dt(function(i){t=i}),cancel:t}}}const _r=Dt;function yr(s){return function(e){return s.apply(null,e)}}function wr(s){return l.isObject(s)&&s.isAxiosError===!0}const xt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xt).forEach(([s,t])=>{xt[t]=s});const xr=xt;function me(s){const t=new st(s),e=Gt(st.prototype.request,t);return l.extend(e,st.prototype,t,{allOwnKeys:!0}),l.extend(e,t,null,{allOwnKeys:!0}),e.create=function(i){return me(X(s,i))},e}const b=me(At);b.Axios=st;b.CanceledError=Z;b.CancelToken=_r;b.isCancel=ue;b.VERSION=pe;b.toFormData=nt;b.AxiosError=x;b.Cancel=b.CanceledError;b.all=function(t){return Promise.all(t)};b.spread=yr;b.isAxiosError=wr;b.mergeConfig=X;b.AxiosHeaders=z;b.formToJSON=s=>ce(l.isHTMLForm(s)?new FormData(s):s);b.HttpStatusCode=xr;b.default=b;const Cr=b,br=Ct({__name:"example13_segmentation_CS",setup(s){let t,e=L(0),r=L(0),i=L(0),a=L(!1),n=L(0),o,c=L(),d=L(),h=L(),u,y,m,f=L(),g=new De({width:300,autoPlace:!1}),S,_,p,P=[],E=L(0),q=!0,N=[],M=L(0);He(()=>{u=c.value,y=d.value,m=h.value,y.appendChild(g.domElement),t=new Le(u),p=ke(),_=new Be(m),m.appendChild(p.loadingContainer),ve("nrrd_tools"),document.addEventListener("keydown",C=>{C.code==="KeyF"&&Ne(u)}),S=g.addFolder("select display contrast"),t.animate()});const B=C=>{M.value=C.length,P=C,P.length>0&&Se(P)},j=C=>{a.value=C},ge=C=>{a.value=C},_e=C=>{_.setSliceOrientation(C),e.value=_.getMaxSliceNum()[1];const{currentIndex:O,contrastIndex:v}=_.getCurrentSlicesNumAndContrastNum();r.value=O,i.value=v},ye=C=>{_.setSliceMoving(C)},we=async(C,O,v,A)=>{const k=[];console.log("here");for(let D=0;D<O;D++){let W={sliceIndex:0,dataFormat:"RGBA - Each successive 4-digit number forms a pixel point in data array",width:v,height:A,voxelSpacing:0,spaceOrigin:0,data:[]};W.sliceIndex=C[D].index;const dt=C[D].image,Pe=Array.from(dt.data).map(Ie=>Number(Ie));W.data=Pe,k.push(W)}return k},Lt=new Worker("/copper3d_examples/assets/worker.30440130.js",{type:"module"});Lt.postMessage("a"),Lt.onmessage=function(C){const O=C.data;console.log(O)};const xe=()=>{setInterval(async()=>{const C=_.paintImages.z,O=_.getCurrentImageDimension(),v=C.length,A=O[0],k=O[1];if(v>0){const D=await we(C,v,A,k);console.log("a"),await Cr.post("http://127.0.0.1:8000/save_mask",{masks:D,len:v,width:A,height:k}),console.log("send")}},2e4)};mt(()=>{if(E.value!=0&&N.length!=0&&E.value===P.length){console.log("All files ready!"),_.clear(),N.sort((v,A)=>v.order-A.order),_.setShowInMainArea(!0),_.setAllSlices(N),n.value=_.getCurrentSliceIndex();const C=(v,A)=>{r.value=v,i.value=A};q?(_.drag({showNumber:!0,getSliceNum:C}),_.draw(o,g),o==null||o.addPreRenderCallbackFunction(_.start),xe()):_.redrawMianPreOnDisplayCanvas(),e.value=_.getMaxSliceNum()[1],setTimeout(()=>{n.value=0,E.value=0},1e3),q=!1;const O={};for(let v=0;v<N.length;v++)if(v==0)O.pre=!0;else{const A="contrast"+v;O[A]=!0}_.removeGuiFolderChilden(S);for(let v=0;v<N.length;v++){let A="";v===0?A="pre":A="contrast"+v,S.add(O,A).onChange(k=>{k?(M.value+=1,_.addSkip(v)):(M.value-=1,_.removeSkip(v));const D=_.getMaxSliceNum()[1];if(D){e.value=D;const{currentIndex:W,contrastIndex:dt}=_.getCurrentSlicesNumAndContrastNum();r.value=W,i.value=dt+1}})}}});const Ce=C=>{_.setMainAreaSize(C)};function ve(C){o=t.getSceneByName(C),o==null&&(o=t.createScene(C),o&&(t.setCurrentScene(o),o&&o.loadViewUrl("/copper3d_examples/nrrd_view.json"),Re("/copper3d_examples/venice_sunset_1k.hdr"),o.updateBackground("#5454ad","#18e5a7")),t.updateEnvironment())}const Se=C=>{N=[];const O=(v,A,k)=>{const D=Object.assign(k,{order:0});N.push(D),f.value=k,E.value+=1};o==null||o.loadNrrd(C[0],p,O);for(let v=1;v<C.length;v++)o==null||o.loadNrrd(C[v],p,(A,k,D)=>{const W=Object.assign(D,{order:v});N.push(W),E.value+=1})};return(C,O)=>(St(),vt("div",{id:"bg",ref_key:"base_container",ref:c},[I("div",{ref_key:"c_gui_ref",ref:d,id:"gui"},null,512),I("div",{ref_key:"nrrd_c_ref",ref:h,class:"nrrd_c"},null,512),V(is,{"file-num":U(M),max:U(e),"immediate-slice-num":U(r),"contrast-index":U(i),"init-slice-index":U(n),onOnSliceChange:ye,onResetMainAreaSize:Ce,onOnChangeOrientation:_e,onOnOpenDialog:j},null,8,["file-num","max","immediate-slice-num","contrast-index","init-slice-index"]),V(ds,{dialog:U(a),onOnCloseDialog:ge,onGetLoadFilesUrls:B},null,8,["dialog"])],512))}});export{br as default};
