var he=Object.defineProperty;var de=(x,c,i)=>c in x?he(x,c,{enumerable:!0,configurable:!0,writable:!0,value:i}):x[c]=i;var E=(x,c,i)=>(de(x,typeof c!="symbol"?c+"":c,i),i);import{W as pe,b as ue,P as me,c as V,e as fe,R as ge,G as ye,E as be,M as N,V as P,d as T,Q as Ee,g as K,C as te,O as Ce,h as $,i as we,B as ve,A as J,j as xe,k as ee,m as Se,n as Pe,K as Te,o as Me,p as ke}from"./index.ef0f5e24.js";var F=function(){var x=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(p){p.preventDefault(),e(++x%c.children.length)},!1);function i(p){return c.appendChild(p.dom),p}function e(p){for(var u=0;u<c.children.length;u++)c.children[u].style.display=u===p?"block":"none";x=p}var n=(performance||Date).now(),o=n,s=0,d=i(new F.Panel("FPS","#0ff","#002")),l=i(new F.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=i(new F.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:c,addPanel:i,showPanel:e,begin:function(){n=(performance||Date).now()},end:function(){s++;var p=(performance||Date).now();if(l.update(p-n,200),p>=o+1e3&&(d.update(s*1e3/(p-o),100),o=p,s=0,h)){var u=performance.memory;h.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return p},update:function(){n=this.end()},domElement:c,setMode:e}};F.Panel=function(x,c,i){var e=1/0,n=0,o=Math.round,s=o(window.devicePixelRatio||1),d=80*s,l=48*s,h=3*s,p=2*s,u=3*s,y=15*s,r=74*s,m=30*s,f=document.createElement("canvas");f.width=d,f.height=l,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,d,l),g.fillStyle=c,g.fillText(x,h,p),g.fillRect(u,y,r,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u,y,r,m),{dom:f,update:function(b,v){e=Math.min(e,b),n=Math.max(n,b),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,d,y),g.fillStyle=c,g.fillText(o(b)+" "+x+" ("+o(e)+"-"+o(n)+")",h,p),g.drawImage(f,u+s,y,r-s,m,u,y,r-s,m),g.fillRect(u+r-s,y,s,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u+r-s,y,s,o((1-b/v)*m))}}};const Oe=F;class Re{constructor(c,i){E(this,"container");E(this,"renderer");E(this,"gui");E(this,"stats");E(this,"currentScene");E(this,"pmremGenerator");E(this,"options");E(this,"state");E(this,"visualiseFolder");E(this,"visualCtrls",[]);E(this,"cameraFolder");var e,n,o,s;this.container=c,this.options=i,this.renderer=new pe({antialias:!0,alpha:!!((e=this.options)!=null&&e.alpha),logarithmicDepthBuffer:!!((n=this.options)!=null&&n.logarithmicDepthBuffer)}),(o=this.options)!=null&&o.alpha&&this.setClearColor(),this.renderer.useLegacyLights=!0,this.renderer.outputColorSpace=ue,this.gui=null,this.stats=new Oe,this.pmremGenerator=new me(this.renderer),this.pmremGenerator.compileEquirectangularShader(),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),(s=this.options)!=null&&s.alpha?this.currentScene=new V(this.container,this.renderer,{alpha:!0}):this.currentScene=new V(this.container,this.renderer,{alpha:!1}),this.currentScene.sceneName="default",this.currentScene.vignette&&this.updateEnvironment(this.currentScene.vignette),this.state={playbackSpeed:1,wireframe:!1,skeleton:!1,grid:!1,addLights:!0,exposure:1,ambientIntensity:.3,ambientColor:2105376,directIntensity:.8*Math.PI,directColor:16777215,bgColor1:"#5454ad",bgColor2:"#18e5a7"},this.visualiseFolder=null,this.cameraFolder=null,this.init()}init(){var c;this.currentScene.sceneName===""&&(this.currentScene.sceneName="default"),((c=this.options)==null?void 0:c.guiOpen)&&!this.gui&&this.addGui(),[].forEach.call(this.stats.dom.children,i=>i.style.display=""),this.container.appendChild(this.renderer.domElement)}updateEnvironment(c){const i=fe.filter(e=>e.name==="Venice Sunset")[0];this.getCubeMapTexture(i).then(e=>{const n=this.getCurrentScene();e&&c&&(n==null||n.scene.add(c.mesh)),n.scene.environment=e,n.scene.background=e})}getCubeMapTexture(c){const{path:i}=c;return i?new Promise((e,n)=>{new ge().load(i,o=>{const s=this.pmremGenerator.fromEquirectangular(o).texture;this.pmremGenerator.dispose(),e(s)},void 0,n)}):Promise.resolve({envMap:null})}getCurrentScene(){return this.currentScene}hideGui(){this.gui&&this.gui.hide()}closeGui(){this.gui&&(this.gui.closed=!0)}setClearColor(c=0,i=0){this.renderer.setClearColor(c,i)}addGui(){var s,d,l;const c=this.gui=new ye({width:260}),i=c.addFolder("Visualisation settings");i.add(this.state,"wireframe").onChange(()=>this.currentScene.updateDisplay(this.state)),this.visualiseFolder=i.addFolder("ModelVisualisation");const n=i.addColor(this.state,"bgColor1"),o=i.addColor(this.state,"bgColor2");if(n.onChange(()=>this.currentScene.updateBackground(this.state.bgColor1,this.state.bgColor2)),o.onChange(()=>this.currentScene.updateBackground(this.state.bgColor1,this.state.bgColor2)),(s=this.options)!=null&&s.cameraGui&&(this.cameraFolder=c.addFolder("Camera")),(d=this.options)!=null&&d.performanceGui){const h=c.addFolder("Performance"),p=document.createElement("li");this.stats.dom.style.position="static",p.appendChild(this.stats.dom),p.style.height="50px",h.__ul.appendChild(p)}if((l=this.options)!=null&&l.lightGui){const h=c.addFolder("LightsFolder");[h.add(this.state,"addLights").listen(),h.add(this.state,"ambientIntensity",0,2),h.addColor(this.state,"ambientColor"),h.add(this.state,"directIntensity",0,4),h.addColor(this.state,"directColor")].forEach(p=>p.onChange(()=>this.currentScene.updateLights(this.state)))}}updateGui(){this.visualCtrls.length!==0&&this.visualCtrls.forEach(e=>{var n;(n=this.visualiseFolder)==null||n.remove(e)}),this.visualCtrls=[];let c=0;const i=setInterval(()=>{var o,s,d,l,h,p,u,y;(this.currentScene.content.children.length>0||c>=5)&&(c=0,clearInterval(i));let e=[];(o=this.currentScene.content)==null||o.children;const n=r=>{if(r.isMesh){const m={name:r.name||"Untitled",visible:r.visible,mesh:r};e.push(m)}};if((s=this.currentScene.content)==null||s.traverse(r=>{r.isMesh&&n(r)}),e.forEach(r=>{const m=this.visualiseFolder.add(r,"visible").name(r.name).onChange(()=>{this.currentScene.updateModelChildrenVisualisation(r.mesh)});this.visualCtrls.push(m)}),this.cameraFolder){if(this.cameraFolder.__controllers.length>0){const g=[];this.cameraFolder.__controllers.forEach(b=>{g.push(b)}),g.forEach(b=>{var v;(v=this.cameraFolder)==null||v.remove(b)})}(d=this.cameraFolder)==null||d.add(this.currentScene.camera,"near"),(l=this.cameraFolder)==null||l.add(this.currentScene.camera,"far");const r=(h=this.cameraFolder)==null?void 0:h.__folders;for(let g in r)if(Object.prototype.hasOwnProperty.call(r,g)){const b=r[g];(p=this.cameraFolder)==null||p.removeFolder(b)}const m=(u=this.cameraFolder)==null?void 0:u.addFolder("position");m.add(this.currentScene.camera.position,"x"),m.add(this.currentScene.camera.position,"y"),m.add(this.currentScene.camera.position,"z");const f=(y=this.cameraFolder)==null?void 0:y.addFolder("up");f.add(this.currentScene.camera.up,"x"),f.add(this.currentScene.camera.up,"y"),f.add(this.currentScene.camera.up,"z")}c+=1},3e3)}}const G={type:"change"},Z={type:"start"},H={type:"end"};class je extends be{constructor(c,i){super();const e=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=c,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:N.ROTATE,MIDDLE:N.DOLLY,RIGHT:N.PAN},this.target=new P;const o=1e-6,s=new P;let d=1,l=n.NONE,h=n.NONE,p=0,u=0,y=0;const r=new P,m=new T,f=new T,g=new P,b=new T,v=new T,k=new T,R=new T,C=[],_={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const t=e.domElement.getBoundingClientRect(),a=e.domElement.ownerDocument.documentElement;e.screen.left=t.left+window.pageXOffset-a.clientLeft,e.screen.top=t.top+window.pageYOffset-a.clientTop,e.screen.width=t.width,e.screen.height=t.height};const j=function(){const t=new T;return function(w,S){return t.set((w-e.screen.left)/e.screen.width,(S-e.screen.top)/e.screen.height),t}}(),A=function(){const t=new T;return function(w,S){return t.set((w-e.screen.width*.5-e.screen.left)/(e.screen.width*.5),(e.screen.height+2*(e.screen.top-S))/e.screen.width),t}}();this.rotateCamera=function(){const t=new P,a=new Ee,w=new P,S=new P,M=new P,O=new P;return function(){O.set(f.x-m.x,f.y-m.y,0);let z=O.length();z?(r.copy(e.object.position).sub(e.target),w.copy(r).normalize(),S.copy(e.object.up).normalize(),M.crossVectors(S,w).normalize(),S.setLength(f.y-m.y),M.setLength(f.x-m.x),O.copy(S.add(M)),t.crossVectors(O,r).normalize(),z*=e.rotateSpeed,a.setFromAxisAngle(t,z),r.applyQuaternion(a),e.object.up.applyQuaternion(a),g.copy(t),y=z):!e.staticMoving&&y&&(y*=Math.sqrt(1-e.dynamicDampingFactor),r.copy(e.object.position).sub(e.target),a.setFromAxisAngle(g,y),r.applyQuaternion(a),e.object.up.applyQuaternion(a)),m.copy(f)}}(),this.zoomCamera=function(){let t;l===n.TOUCH_ZOOM_PAN?(t=p/u,p=u,e.object.isPerspectiveCamera?r.multiplyScalar(t):e.object.isOrthographicCamera?(e.object.zoom=K.clamp(e.object.zoom/t,e.minZoom,e.maxZoom),d!==e.object.zoom&&e.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(t=1+(v.y-b.y)*e.zoomSpeed,t!==1&&t>0&&(e.object.isPerspectiveCamera?r.multiplyScalar(t):e.object.isOrthographicCamera?(e.object.zoom=K.clamp(e.object.zoom/t,e.minZoom,e.maxZoom),d!==e.object.zoom&&e.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),e.staticMoving?b.copy(v):b.y+=(v.y-b.y)*this.dynamicDampingFactor)},this.panCamera=function(){const t=new T,a=new P,w=new P;return function(){if(t.copy(R).sub(k),t.lengthSq()){if(e.object.isOrthographicCamera){const M=(e.object.right-e.object.left)/e.object.zoom/e.domElement.clientWidth,O=(e.object.top-e.object.bottom)/e.object.zoom/e.domElement.clientWidth;t.x*=M,t.y*=O}t.multiplyScalar(r.length()*e.panSpeed),w.copy(r).cross(e.object.up).setLength(t.x),w.add(a.copy(e.object.up).setLength(t.y)),e.object.position.add(w),e.target.add(w),e.staticMoving?k.copy(R):k.add(t.subVectors(R,k).multiplyScalar(e.dynamicDampingFactor))}}}(),this.checkDistances=function(){(!e.noZoom||!e.noPan)&&(r.lengthSq()>e.maxDistance*e.maxDistance&&(e.object.position.addVectors(e.target,r.setLength(e.maxDistance)),b.copy(v)),r.lengthSq()<e.minDistance*e.minDistance&&(e.object.position.addVectors(e.target,r.setLength(e.minDistance)),b.copy(v)))},this.update=function(){r.subVectors(e.object.position,e.target),e.noRotate||e.rotateCamera(),e.noZoom||e.zoomCamera(),e.noPan||e.panCamera(),e.object.position.addVectors(e.target,r),e.object.isPerspectiveCamera?(e.checkDistances(),e.object.lookAt(e.target),s.distanceToSquared(e.object.position)>o&&(e.dispatchEvent(G),s.copy(e.object.position))):e.object.isOrthographicCamera?(e.object.lookAt(e.target),(s.distanceToSquared(e.object.position)>o||d!==e.object.zoom)&&(e.dispatchEvent(G),s.copy(e.object.position),d=e.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){l=n.NONE,h=n.NONE,e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.up.copy(e.up0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),r.subVectors(e.object.position,e.target),e.object.lookAt(e.target),e.dispatchEvent(G),s.copy(e.object.position),d=e.object.zoom};function Y(t){e.enabled!==!1&&(C.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",L),e.domElement.addEventListener("pointerup",I)),ce(t),t.pointerType==="touch"?se(t):ne(t))}function L(t){e.enabled!==!1&&(t.pointerType==="touch"?re(t):ie(t))}function I(t){e.enabled!==!1&&(t.pointerType==="touch"?ae(t):oe(),W(t),C.length===0&&(e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",L),e.domElement.removeEventListener("pointerup",I)))}function X(t){W(t)}function D(t){e.enabled!==!1&&(window.removeEventListener("keydown",D),h===n.NONE&&(t.code===e.keys[n.ROTATE]&&!e.noRotate?h=n.ROTATE:t.code===e.keys[n.ZOOM]&&!e.noZoom?h=n.ZOOM:t.code===e.keys[n.PAN]&&!e.noPan&&(h=n.PAN)))}function U(){e.enabled!==!1&&(h=n.NONE,window.addEventListener("keydown",D))}function ne(t){if(l===n.NONE)switch(t.button){case e.mouseButtons.LEFT:l=n.ROTATE;break;case e.mouseButtons.MIDDLE:l=n.ZOOM;break;case e.mouseButtons.RIGHT:l=n.PAN;break}const a=h!==n.NONE?h:l;a===n.ROTATE&&!e.noRotate?(f.copy(A(t.pageX,t.pageY)),m.copy(f)):a===n.ZOOM&&!e.noZoom?(b.copy(j(t.pageX,t.pageY)),v.copy(b)):a===n.PAN&&!e.noPan&&(k.copy(j(t.pageX,t.pageY)),R.copy(k)),e.dispatchEvent(Z)}function ie(t){const a=h!==n.NONE?h:l;a===n.ROTATE&&!e.noRotate?(m.copy(f),f.copy(A(t.pageX,t.pageY))):a===n.ZOOM&&!e.noZoom?v.copy(j(t.pageX,t.pageY)):a===n.PAN&&!e.noPan&&R.copy(j(t.pageX,t.pageY))}function oe(){l=n.NONE,e.dispatchEvent(H)}function B(t){if(e.enabled!==!1&&e.noZoom!==!0){switch(t.preventDefault(),t.deltaMode){case 2:b.y-=t.deltaY*.025;break;case 1:b.y-=t.deltaY*.01;break;default:b.y-=t.deltaY*25e-5;break}e.dispatchEvent(Z),e.dispatchEvent(H)}}function se(t){switch(Q(t),C.length){case 1:l=n.TOUCH_ROTATE,f.copy(A(C[0].pageX,C[0].pageY)),m.copy(f);break;default:l=n.TOUCH_ZOOM_PAN;const a=C[0].pageX-C[1].pageX,w=C[0].pageY-C[1].pageY;u=p=Math.sqrt(a*a+w*w);const S=(C[0].pageX+C[1].pageX)/2,M=(C[0].pageY+C[1].pageY)/2;k.copy(j(S,M)),R.copy(k);break}e.dispatchEvent(Z)}function re(t){switch(Q(t),C.length){case 1:m.copy(f),f.copy(A(t.pageX,t.pageY));break;default:const a=le(t),w=t.pageX-a.x,S=t.pageY-a.y;u=Math.sqrt(w*w+S*S);const M=(t.pageX+a.x)/2,O=(t.pageY+a.y)/2;R.copy(j(M,O));break}}function ae(t){switch(C.length){case 0:l=n.NONE;break;case 1:l=n.TOUCH_ROTATE,f.copy(A(t.pageX,t.pageY)),m.copy(f);break;case 2:l=n.TOUCH_ZOOM_PAN;for(let a=0;a<C.length;a++)if(C[a].pointerId!==t.pointerId){const w=_[C[a].pointerId];f.copy(A(w.x,w.y)),m.copy(f);break}break}e.dispatchEvent(H)}function q(t){e.enabled!==!1&&t.preventDefault()}function ce(t){C.push(t)}function W(t){delete _[t.pointerId];for(let a=0;a<C.length;a++)if(C[a].pointerId==t.pointerId){C.splice(a,1);return}}function Q(t){let a=_[t.pointerId];a===void 0&&(a=new T,_[t.pointerId]=a),a.set(t.pageX,t.pageY)}function le(t){const a=t.pointerId===C[0].pointerId?C[1]:C[0];return _[a.pointerId]}this.dispose=function(){e.domElement.removeEventListener("contextmenu",q),e.domElement.removeEventListener("pointerdown",Y),e.domElement.removeEventListener("pointercancel",X),e.domElement.removeEventListener("wheel",B),e.domElement.removeEventListener("pointermove",L),e.domElement.removeEventListener("pointerup",I),window.removeEventListener("keydown",D),window.removeEventListener("keyup",U)},this.domElement.addEventListener("contextmenu",q),this.domElement.addEventListener("pointerdown",Y),this.domElement.addEventListener("pointercancel",X),this.domElement.addEventListener("wheel",B,{passive:!1}),window.addEventListener("keydown",D),window.addEventListener("keyup",U),this.handleResize(),this.update()}}class Ae extends V{constructor(i,e,n){super(i,e,n);E(this,"clock",new te);E(this,"controls");E(this,"mixer",null);E(this,"playRate",1);E(this,"modelReady",!1);E(this,"clipAction");E(this,"texture2dMesh",null);(n==null?void 0:n.controls)==="trackball"?this.controls=new je(this.camera,this.renderer.domElement):(n==null?void 0:n.controls)==="orbit"?this.controls=new Ce(this.camera,this.renderer.domElement):this.controls=new $(this.camera,this.renderer.domElement),this.controls.panSpeed=3,this.controls.rotateSpeed=3,window.addEventListener("resize",this.onWindowResize,!1)}loadGltf(i,e){we(this.renderer).load(i,o=>{const s=new ve().setFromObject(o.scene),d=s.getSize(new P).length(),l=s.getCenter(new P);this.controls.maxDistance=d*10,o.scene.position.x+=o.scene.position.x-l.x,o.scene.position.y+=o.scene.position.y-l.y,o.scene.position.z+=o.scene.position.z-l.z,this.cameraPositionFlag||(this.camera.position.copy(l),this.camera.position.x+=d/2,this.camera.position.y+=d/5,this.camera.position.z+=d/2,this.camera.lookAt(l),this.viewPoint=this.setViewPoint(this.camera,[l.x,l.y,l.z])),this.mixer=new J(o.scene),o.animations.forEach((h,p)=>{var u,y;p===0?this.clipAction=(u=this.mixer)==null?void 0:u.clipAction(h).play():(y=this.mixer)==null||y.clipAction(h).play()}),this.content=o.scene,this.exportContent.copy(o.scene),this.exportContent.animations=o.animations,this.scene.add(o.scene),this.modelReady=!0,e&&e(o.scene)},o=>{})}loadVtk(i){xe(i,this.scene,this.content)}loadVtks(i){let e=0,{vtkLoader:n}=ee();const o=new Se,s=setInterval(()=>{e===i.length&&(this.scene.add(this.exportContent),this.mixer=new J(o),this.exportContent.animations.forEach(l=>{var p;const h=(p=this.mixer)==null?void 0:p.clipAction(l);h.timeScale=3,h.play()}),this.modelReady=!0,clearInterval(s))},100);i.forEach(l=>{const h=[];l.urls.forEach((p,u)=>{n.load(p,y=>{y.center(),y.computeVertexNormals(),y.name=u.toString(),h.push(y),h.length===l.urls.length&&(h.sort((r,m)=>this.sort?parseInt(r.name)-parseInt(m.name):parseInt(m.name)-parseInt(r.name)),d(h,l),e+=1)})})});const d=(l,h)=>{let{vtkmaterial:p}=ee(h.opts),u=l[0];u.attributes.position,l.forEach((b,v)=>{v===0?(u=b,u.morphAttributes.position=[]):u.morphAttributes.position.push(b.attributes.position)});const y=new Pe(u,p);y.scale.multiplyScalar(.1),o.add(y),this.exportContent.add(o),y.morphTargetInfluences=[],y.name=h.name;let r=0,m=[],f=l.length-1;for(let b=0;b<f;b++){const v=new Te(`${y.name}.morphTargetInfluences[${b}]`,[r,r+1,r+2],[0,1,0]);m.push(v),r=r+2}const g=new Me(`copper3d_heart_morph_${y.name}`,f,m);this.exportContent.animations.push(g)}}texture2d(i){ke(i,this.scene);const e=setInterval(()=>{var n;this.scene.children.forEach(o=>{if(o.isMesh&&o.name==="texture2d_mesh_zip"){this.texture2dMesh=o;const s=()=>{if(this.texture2dMesh){let d=this.texture2dMesh.material.uniforms.depth.value;d+=this.depthStep,(d>109||d<0)&&(d>1&&(d=109*2-d),d<0&&(d=-d),this.depthStep=-this.depthStep),this.texture2dMesh.material.uniforms.depth.value=d}};this.addPreRenderCallbackFunction(s)}}),((n=this.texture2dMesh)==null?void 0:n.name)==="texture2d_mesh_zip"&&clearInterval(e)},500)}getPlayRate(){return this.playRate}setPlayRate(i){this.playRate=i}setModelPosition(i,e){e.x&&(i.position.x=e.x),e.y&&(i.position.y=e.y),e.z&&(i.position.z=e.z)}resetView(){this.controls.reset(),this.updateCamera(this.viewPoint)}updateCamera(i){this.cameraPositionFlag=!0,this.copperControl.updateCameraViewPoint(i)}getCurrentTime(){let i=0;return this.clipAction&&(i=this.clipAction.time/this.clipAction._clip.duration),i}getCurrentMixer(){return this.mixer}updateControls(i){this.controls.dispose(),this.controls=new $(i,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.minZoom=.5,this.controls.maxZoom=4}onRenderCameraChange(){const{width:i,height:e}=this.container.getBoundingClientRect(),n=i/e;if(this.renderNrrdVolume){const o=this.camera,s=o.top-o.bottom;o.left=-s*n/2,o.right=s*n/2}else this.camera.aspect=n;this.camera.updateProjectionMatrix()}render(i){this.controls.update(),this.modelReady&&this.mixer&&this.mixer.update(this.clock.getDelta()*this.playRate),this.preRenderCallbackFunctions.cache.length>0&&Object.values(this.preRenderCallbackFunctions.cache).forEach(e=>{e&&e.call(null)}),this.subDiv&&this.subCamera&&this.subRender&&(this.subCamera.aspect=this.subDiv.clientWidth/this.subDiv.clientHeight,this.subCamera.updateProjectionMatrix(),this.subRender.setSize(this.subDiv.clientWidth,this.subDiv.clientHeight),this.subCamera.position.copy(this.camera.position),this.subCamera.lookAt(this.subScene.position),this.subRender.render(this.subScene,this.subCamera)),this.renderer.render(this.scene,this.camera)}}class ze extends Re{constructor(i,e){super(i,e);E(this,"sceneMap",{});E(this,"fps",30);E(this,"renderClock",new te);E(this,"delta",0);E(this,"interval",1/this.fps);E(this,"preRenderCallbackFunctions",[]);E(this,"animate",i=>{var e,n,o;switch((e=this.options)==null?void 0:e.fpsMode){case"1":setTimeout(()=>{requestAnimationFrame(this.animate)},1e3/this.fps),this.render(),(n=this.options)!=null&&n.performanceGui&&this.stats.update();break;default:requestAnimationFrame(this.animate),this.delta===0&&this.render(),this.delta+=this.renderClock.getDelta(),this.delta>this.interval&&(this.render(),(o=this.options)!=null&&o.performanceGui&&this.stats.update(),this.delta=this.delta%this.interval)}})}getSceneByName(i){return this.sceneMap[i]}setFPS(i){this.fps=i}setCurrentScene(i){var e;i&&(this.currentScene=i,(e=this.options)!=null&&e.guiOpen&&this.updateGui(),this.onWindowResize())}createScene(i){var e,n,o;if(this.sceneMap[i]==null){const s=!!((e=this.options)!=null&&e.alpha),d=new Ae(this.container,this.renderer,{camera:(n=this.options)==null?void 0:n.cameraType,controls:(o=this.options)==null?void 0:o.controls,alpha:s});return d.sceneName=i,this.updateEnvironment(d.vignette),this.sceneMap[i]=d,d}}addPreRenderCallbackFunction(i){this.preRenderCallbackFunctions.push(i)}onWindowResize(){}render(){this.currentScene.render(),this.preRenderCallbackFunctions.forEach(i=>{i.call(null)})}}export{ze as c};
